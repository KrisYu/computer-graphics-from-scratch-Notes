# ä½ç½®å˜æ¢

## ç§»åŠ¨ç‰©ä½“

ä¹‹å‰æˆ‘ä»¬åœ¨RenderInstanceä¸­å˜æ¢äº†ç‰©ä½“çš„ä½ç½®ï¼š

```
RenderInstance(instance){
	projected = []
	model = instance.model
	for V in model.vertexes{
		V' = V + instance.position
		projected.append(ProjectVertex(V'))
	}
	for T in model.triangles{
		RenderTriangle(T, projected)
	}
}
```


å…¶å®å¯¹äºç‰©ä½“ä½ç½®ï¼Œå¹¶éåªæœ‰ä½ç½®çš„æ”¹å˜ï¼Œæˆ‘ä»¬å¯ä»¥ scale, rotation å’Œ translation. ä½†æ˜¯éœ€è¦æ³¨æ„ä»–ä»¬çš„é¡ºåºï¼š

![](images/transform.png)


å…ˆç¼©æ”¾ï¼Œå†æ—‹è½¬ï¼Œå†ç§»åŠ¨ã€‚

![](images/transform2.png)

å…ˆç§»åŠ¨ï¼Œå†æ—‹è½¬ï¼Œå†ç¼©æ”¾ã€‚


æ‰€ä»¥ä¸€èˆ¬æ¥è¯´æ˜¯æœ€ååšç§»åŠ¨ translationã€‚å¯¹äºè¿™ä¸ªå˜æ¢çš„æè¿°å¦‚ä¸‹ï¼š


```
instance {
	model = cube
	transform {
		scale = 1.5
		rotation = < 45Â° around the Y axis>
		translation = (1, 2, 3)
	}
}
```

è€Œè¿™ä¸ªä¹Ÿå¯ä»¥å†™æˆå‡½æ•°çš„å½¢å¼ï¼Œæ‰€ä»¥ RenderInstance() å¯ä»¥é‡å†™æˆï¼š


```
RenderInstance(instance){
	projected = []
	model = instance.model
	for V in model.vertexes{
		V' = ApplyTransform(V, instance.transform)
		projected.append(ProjectVertex(V'))
	}
	for T in model.triangles{
		RenderTriangle(T, projected)
	}
}


ApplyTransform(vertex, transform){
	V1 = vertex * transform.scale
	V2 = V1 * transform.rotation
	V3 = V2 + transform.translation
	return V3
}
```

## ç§»åŠ¨æ‘„åƒå¤´/ğŸ‘


å®é™…ä¸Šç§»åŠ¨ğŸ‘å’Œç§»åŠ¨ç‰©ä½“æ˜¯ä¸å¯åˆ†è¾¨çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠğŸ‘æœå‰ç§»ï¼Œä¹Ÿå°±æ˜¯æŠŠç‰©ä½“é è¿‘ï¼Œæ—‹è½¬çœ¼ç›çš„ä½ç½®ä¹Ÿæ˜¯ç›¸å½“äºå›ºå®šğŸ‘ï¼Œæ—‹è½¬ç‰©ä½“ã€‚


```
V1 = V - camera.translation
V2 = V1 * inverse(camera.rotation)
V3 = perspective_projection(V2)
```


## å åŠ èµ·æ¥


ç§»åŠ¨ç‰©ä½“

```
V1 = V * transform.scale
V2 = V1 * transform.rotation
V3 = V2 + transform.translation
```

ç§»åŠ¨ğŸ‘


```
V4 = V3 - camera.translation
V5 = V4 * inverse(camera.rotation)
```

æŠ•å½±

```
vx = v5.x * d / v5.z
vy = v5.y * d / v5.z
```

çœ‹çš„çª—æˆ·åˆ°canvas

```
cx = vx * cw / vw
cy = vy * ch / vh
```

å½“ç„¶å…¶å®è¿˜æœ‰ä¸€æ­¥ï¼Œ canvasç”»å¸ƒåˆ°å±å¹•ã€‚

ç”¨$C_T, C_R$è¡¨ç¤ºcameraçš„translation å’Œ rotationï¼Œ$I_R, I_S, I_T$ è¡¨ç¤ºç‰©ä½“çš„ rotationï¼Œ scale å’Œ translationï¼Œ Pè¡¨ç¤º æŠ•å½±ï¼ŒMè¡¨ç¤º çª—æˆ·åˆ°ç”»å¸ƒã€‚ $V$è¡¨ç¤ºåŸå§‹åæ ‡ã€‚ $V'$è¡¨ç¤ºç”»å¸ƒä¸Šçš„ç‚¹é‚£ä¹ˆ

$$
V' = M(P(C_R^{-1}(C_T^{-1}(I_T(I_S(I_R(V)))))))
$$

åŒæ—¶æ³¨æ„æˆ‘ä»¬ä¾æ—§æŠŠå˜åŒ–æ”¾åœ¨æœ€ç»ˆä½ç½®ã€‚

å†™Få¦‚ä¸‹ï¼š

$$
F = M \cdot P \cdot C_R^{-1} \cdot C_T^{-1} \cdot I_T \cdot I_S \cdot I_R
$$

$$
V' = F(V)
$$





