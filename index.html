<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>foo</title>


<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}

kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb
}

* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}
</style>


</head>

<body>

<h1 id="toc_0">RayTracying</h1>

<p>RayTracyingæœ€å…³é”®çš„ç‚¹æ˜¯ï¼š </p>

<p>ğŸ‘çœ‹å‡ºå»çš„ä¸–ç•Œ</p>

<p>è€Œéä¸–ç•Œå¦‚ä½•è¾¾åˆ°ğŸ‘</p>

<p><img src="images/raytracing.png" alt=""></p>

<p>è¿™ä¹Ÿæ˜¯è¿™ä¸ªç®—æ³•å«åšray tracying - å…‰çº¿è·Ÿè¸ªçš„åŸå› ã€‚</p>

<h1 id="toc_1">ä¾‹å­</h1>

<h2 id="toc_2">1.é¢„å¤‡çŸ¥è¯†</h2>

<h3 id="toc_3">1.1 å±å¹•åæ ‡ vs ç”»å¸ƒåæ ‡</h3>

<p>ä¸€èˆ¬æ¥è¯´å±å¹•åæ ‡éƒ½æ˜¯å§‹äºå·¦ä¸Šè§’ï¼Œç„¶åæœå³å’Œä¸‹å»¶ä¼¸ã€‚</p>

<p><img src="images/screen_coordinate.png" alt=""></p>

<p>ä¸è¿‡è¿™é‡Œä¸ºäº†ä½œå›¾æ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠåæ ‡ç³»æŒ‰ç…§æ•°å­¦ä¸­æ›´å¸¸è§çš„æ–¹å¼æŠŠåŸç‚¹æ”¾äºå±å¹•ä¸­å¤®ï¼Œxå’Œyçš„å»¶ä¼¸æ–¹å‘æŒ‰ç…§å¹³æ—¶çš„ä¹ æƒ¯æ¥æ”¾ã€‚</p>

<p><img src="images/canvas_coordinate.png" alt="">
è¿™æ ·å¯ä»¥çŸ¥é“å±å¹•åæ ‡ç³»\(S_x\)å’Œç”»å¸ƒåæ ‡ç³»\(C_x\)çš„å˜æ¢:</p>

<p>\[
S_x = \frac{C_w}{2} + C_x
\]</p>

<p>\[
S_y = \frac{C_h}{2} - C_y
\]</p>

<h3 id="toc_4">1.2 ç”»å¸ƒ vs çª—æˆ·</h3>

<p>å› ä¸ºæˆ‘ä»¬å±å¹•æ˜¯äºŒç»´çš„ï¼Œæ— è®ºæˆ‘ä»¬æ€æ ·æ¨¡æ‹Ÿï¼Œå®é™…ä¸Šéƒ½æ˜¯è¦æŠŠç‰©ä½“ç”»åœ¨ä¸€ä¸ªäºŒç»´çš„å¹³é¢ï¼ˆç”»å¸ƒï¼‰ä¸Šï¼Œæˆ‘ä»¬è¿™é‡Œå°±å‡è®¾æˆ‘ä»¬æŠŠğŸ‘æ”¾åœ¨åŸç‚¹ä¸Šï¼Œè€Œæœ‰ä¸€æ‰‡çª—æˆ·åœ¨åæ ‡è½´ z = d å¤„ ï¼Œæˆ‘ä»¬çœ¼ç›èƒ½çœ‹åˆ°çš„ä¹Ÿå°±æ˜¯çª—æˆ·å‡ºå»çš„ä¸–ç•Œã€‚</p>

<p>é‚£ä¹ˆå¯¹äºç”»å¸ƒä¸Šçš„ä»»æ„ä¸€ç‚¹ï¼Œåœ¨çª—æˆ·ä¸Šéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ä½ç½®ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä¸­å¿ƒç›¸åŒå¹³é¢å¹³è¡Œã€‚</p>

<p><img src="images/window.png" alt=""></p>

<p>æ‰€ä»¥å¯¹ç”»å¸ƒä¸Šçš„æ¯ä¸€ä¸ªç‚¹\(C_x, C_y\)æˆ‘ä»¬éƒ½èƒ½æ‰¾åˆ°çª—æˆ·ä¸Šçš„å¯¹åº”ç‚¹\(V_x, V_y\)ï¼ŒåŠ ä¸Šä¸Šä¸€æ®µè¯ä¸­çš„å¯¹åº”å…³ç³»ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ¯”ä¾‹çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»§ç»­çŸ¥é“ç”»å¸ƒåæ ‡ç³»\(C_x, C_y\)åœ¨çª—æˆ·ä¸Šçš„å¯¹åº”åæ ‡\(V_x, V_y\)ä¸ºï¼š</p>

<p>\[
V_x = C_x\frac{V_w}{C_w}
\]</p>

<p>\[
V_y = C_y\frac{V_h}{C_h}
\]</p>

<p>åŒæ—¶å› ä¸ºçª—æˆ·æ”¾åœ¨ z = d å¤„ï¼Œæˆ‘ä»¬çŸ¥é“ï¼š</p>

<p>\[
V_z = d
\]</p>

<p>è¿™å°±æœ‰äº†å¦‚ä½•å°†ç”»å¸ƒä¸Šçš„æ¯ä¸€ç‚¹è½¬åŒ–ä¸ºçª—æˆ·ä¸Šçš„æ¯ä¸€ç‚¹çš„åæ ‡å˜æ¢ã€‚</p>

<h3 id="toc_5">1.3 çª—æˆ· vs ç©ºé—´</h3>

<p>ä»çœ¼ç›ğŸ‘å°„å‡ºçš„å…‰çº¿ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥çœ‹æˆæ˜¯\(\overrightarrow{OP}\)ã€‚</p>

<p>åŒæ—¶Pç‚¹ä½ç½®ä¹Ÿå¯ä»¥å†™æˆï¼š \(P = O + t(V-O)\), ä»¤\(\overrightarrow{D}\)ä¸º\(V-O\)ï¼Œä¹Ÿå°±æ˜¯å…¶æ–¹å‘çš„å‘é‡ï¼Œå¦‚ä¸‹å›¾ï¼š</p>

<p>\[
P = O + t\overrightarrow{D}
\]</p>

<p><img src="images/vector.png" alt=""></p>

<p><img src="images/vector2.png" alt=""></p>

<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯: O,P,Væ˜¯ä½ç½®ï¼Œ\(\overrightarrow{OP}ï¼Œ \overrightarrow{D}\)æ˜¯å‘é‡ã€‚</p>

<p>åŒæ—¶çŸ¥é“ï¼š</p>

<ul>
<li>t &lt; 0: é€†å‘äºå…‰çº¿ä¸Šçš„ç‚¹</li>
<li>t = 0: åŸç‚¹</li>
<li>t &gt; 0 &amp;&amp; t &lt; 1: åŸç‚¹åˆ°Vç‚¹ä¹‹é—´çš„ç‚¹ï¼Œä¹Ÿå°±æ˜¯åŸç‚¹åˆ°çª—æˆ·ä¹‹é—´çš„ç‚¹</li>
<li>t = 1: Vç‚¹</li>
<li>t &gt; 1: Vç‚¹ä¹‹åï¼Œä¾æ—§åœ¨å°„å‡ºçš„å…‰çº¿ä¹‹ä¸Šï¼Œå½“tå–æŸä¸ªå€¼ä¸ºPç‚¹</li>
</ul>

<h2 id="toc_6">2.ç©ºé—´æ”¾ç‰©ä½“</h2>

<p>è¿™é‡Œæˆ‘ä»¬åœ¨ç©ºé—´ä¸­æ”¾ç½®ä¸€ä¸ªçƒä½“</p>

<p><img src="images/sphere.png" alt=""></p>

<p>çƒå¿ƒä¸ºCï¼Œé‚£ä¹ˆçƒä¸Šç‚¹Péœ€è¦æ»¡è¶³æ–¹ç¨‹ï¼š</p>

<p><img src="images/sphere2.png" alt=""></p>

<p>\[
|P - C| = r 
\]</p>

<h2 id="toc_7">3. å¤„ç†äº¤äº’ è·Ÿè¸ªå…‰çº¿</h2>

<p>å‡è®¾OPå°±æ˜¯æˆ‘ä»¬çœ‹å‡ºå»çš„å…‰çº¿ï¼Œæ¥è¿½è¸ªå®ƒï¼Œå½“çœ‹å‘çƒä½“æ—¶ï¼Œå®ƒä¼šä¸çƒä½“äº§ç”Ÿäº¤äº’ï¼Œå›¾ä¸­è¿™æ¡å…‰çº¿å°±æ˜¯å’Œçƒä½“ç›¸é‡äº†ï¼š</p>

<p><img src="images/raymeetsphere0.png" alt=""></p>

<p>çƒä¸Šçš„å±äºè¿™æ¡å…‰çº¿çš„Pç‚¹åº”è¯¥æ»¡è¶³ï¼š</p>

<p>\[
P = O + t\overrightarrow{D}
\]</p>

<p>\[
|P - C| = r 
\]</p>

<p>ä»£å…¥1å¼è¿›2å¼ï¼š</p>

<p>\[
| O + t\overrightarrow{D} - C| = r 
\]</p>

<p>\[
| t\overrightarrow{D} + \overrightarrow{OC}| = r 
\]</p>

<p>æ¥è§£æ–¹ç¨‹ï¼š</p>

<p>\[
(t\overrightarrow{OD} + \overrightarrow{OC})(t\overrightarrow{OD} +\overrightarrow{OC}) = r^2 
\]</p>

<p>å±•å¼€ï¼š</p>

<p>\[
t^2|\overrightarrow{OD}|^2 + 2 t\overrightarrow{OD}\cdot\overrightarrow{OC} + |\overrightarrow{OC}|^2 -r^2 = 0 
\]</p>

<p>ä»¤ </p>

<p>\[
k_1 = |\overrightarrow{OD}|^2 â€‹
\]</p>

<p>\[
k_2 = 2 \overrightarrow{OD}\cdot\overrightarrow{OC}â€‹
\]</p>

<p>\[
k_3 = |\overrightarrow{OC}|^2 -r^2
\]</p>

<p>è¿™å°±å˜æˆè§£å…³äºtçš„ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ï¼š</p>

<p>\[
{t_1, t_2} 
= \begin{equation}
\frac{ -k_2 \pm \sqrt{k_2^2 - 4k_1k_3} }
{2k_1}
\end{equation}
\]</p>

<p>ä¼šå‡ºç°ï¼š</p>

<ul>
<li>\(k_2^2 - 4k_1k_3 &gt; 0\) ï¼š ä¸¤ä¸ªè§£</li>
<li>\(k_2^2 - 4k_1k_3 = 0\) ï¼š ä¸€ä¸ªè§£</li>
<li>\(k_2^2 - 4k_1k_3 &lt; 0\) ï¼š æ— è§£</li>
</ul>

<p>å¯¹åº”çš„å°±æ˜¯ä¸‹å›¾çš„çŠ¶å†µï¼š</p>

<p><img src="images/raymeetsphere2.png" alt=""></p>

<p>æ‰€ä»¥é—®é¢˜å°±å˜ç®€å•äº†ï¼Œå¦‚æœæˆ‘ä»¬æœ‰äº¤äº’ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å±•ç¤ºçš„æ˜¯è¿‘çš„ç‚¹\(t_1\)çš„é¢œè‰²ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰äº¤äº’ï¼Œé‚£ä¹ˆæˆ‘ä»¬å±•ç¤ºçš„å°±æ˜¯èƒŒæ™¯è‰²ã€‚</p>

<p>ä»¥ä¸Šå°±æ˜¯å…‰çº¿è¿½è¸ªçš„æ ¹æœ¬åŸç†ã€‚</p>

<h2 id="toc_8">è‡³æ­¤ã®ä¼ªç </h2>

<h3 id="toc_9">è·Ÿè¸ªå…‰çº¿ä¸çƒç›¸äº¤ IntersectRaySphere</h3>

<div><pre><code class="language-none">IntersectRaySphere(O, D, sphere){
    C = sphere.center
    r = sphere.radius
    oc = O - C

    k1 = dot(OD, OD)
    k2 = 2 * dot(OC, OD)
    k3 = dot(OC,OC) - r*r

    discriminant = k2 * k2 - 4 * k1 * k3
    if discriminant &lt; 0:
        return inf, inf

    t1 = (-k2 + sqrt(discriminant))/(2*k1)
    t2 = (-k2 - sqrt(discriminant))/(2*k1)
    return t1, t2
}</code></pre></div>

<h3 id="toc_10">t1 çš„é¢œè‰²TraceRay</h3>

<p>è¿™é‡Œæˆ‘ä»¬åœ¨ç©ºé—´é‡Œæ”¾å…¥å¥½å‡ ä¸ªçƒä½“ï¼Œç„¶åè®¡ç®—t1å¤„çš„é¢œè‰²ä¼ªç å¦‚ä¸‹ï¼š</p>

<div><pre><code class="language-none">TraceRay(O, D, t_min, t_max){
    closest_t = inf
    closest_sphere = NULL
    for sphere in scene.Spheres {
        t1, t2 = IntersectRaySphere(O, D, sphere)
        if t1 in [t_min, t_max] &amp;&amp; t1 &lt; closest_t
            closest_t = t1
            closest_sphere = sphere
        if t2 in [t_min, t_max] &amp;&amp; t2 &lt; closest_t
            closest_t = t2
            closest_sphere = sphere
    }

    if closest_sphere == NULL
        return BACKGROUND_COLOR

    return closest_sphere.color 
}</code></pre></div>

<p>æˆ‘ä»¬åœ¨ç©ºé—´ä¸­æ”¾å…¥ä¸‰ä¸ªå°çƒï¼š</p>

<p><img src="images/3spheres.png" alt=""></p>

<h3 id="toc_11">ç”»åˆ°ç”»å¸ƒä¸Š</h3>

<p>åœ¨ä¸Šè¿°ä¸‰ä¸ªä¼ªç å‡½æ•°ä¸­ï¼Œæœ€ç»ˆæ˜¯TraceRayè¿™ä¸ªå‡½æ•°è°ƒç”¨äº†å…¶ä½™ä¸¤ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨éœ€è¦æ¥è®¾å®šå®ƒçš„å‚æ•°ã€‚</p>

<h4 id="toc_12">D</h4>

<p>Dè¿™ä¸ªå®é™…ä¸Šä¹‹å‰å·²ç»å†™åˆ°ï¼Œå°±æ˜¯ä»Oåˆ°Vçš„å‘é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„Våˆç”±æœ€æ—©çš„ç”»å¸ƒåˆ°çª—æˆ·å¯ä»¥å¾—çŸ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æœ‰å‡½æ•°ï¼š</p>

<div><pre><code class="language-none">CanvasToViewport(x, y){
    return (x * Vw/Cw, y * Vh/Ch, d)
}</code></pre></div>

<h3 id="toc_13">t_min, t_max</h3>

<p>t = 1 æ˜¯Vï¼Œæ˜¯åœ¨çª—æˆ·ä¸Šï¼Œt &gt; 1 æ˜¯çª—æˆ·ä¹‹åï¼Œæ˜¯åœºæ™¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å–çš„å€¼æ˜¯ t_min = 1,æˆ‘ä»¬å¹¶ä¸éœ€è¦æ‘„åƒå¤´å’Œçª—æˆ·ä¹‹é—´çš„é¢œè‰²ï¼Œå› ä¸ºæˆ‘ä»¬ä¹Ÿæ²¡æœ‰æ”¾ä»»ä½•ä¸œè¥¿åœ¨é‚£é‡Œï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯çª—æˆ·ä¹‹åçš„æ™¯è‰²ï¼Œæ‰€ä»¥ t_min = 1, t_max = inf</p>

<h4 id="toc_14">ç»„è£…</h4>

<p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯æ¥åšå¾ªç¯ï¼ŒæŠŠæ‰€æœ‰çš„ä»£ç ç»„è£…åœ¨ä¸€èµ·ï¼Œæ”¾åœ¨å±å¹•ä¸Šï¼Œæ‰€ä»¥ä¼ªç å¦‚ä¸‹ï¼š</p>

<div><pre><code class="language-none">O = &lt;0,0,0&gt;

for x in [-Cw/2, Cw/2]{
    for y in [-Ch/2, Ch/2]{
        D = CanvasToViewport(x, y)
        color = TraceRay(O, D, t_min, t_max)
        canvas.putPixel(x, y, color)
    }
}</code></pre></div>

<p>å¯¹åº”çš„çª—æˆ·å¤§å°å’Œè·ç¦»éƒ½å¯ä»¥åœ¨ä»£ç ä¸­çœ‹åˆ°ï¼Œçœ‹ç»“æœï¼š</p>

<p><img src="images/raytracying01.png" alt=""></p>

<p>è¿™æ ¹æœ¬çœ‹èµ·æ¥ä¸3dï¼Œå¾ˆç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰è€ƒè™‘<strong>å…‰</strong>çš„ä½œç”¨ã€‚</p>

<p><a href="code/raytracying01.py">ä»£ç é“¾æ¥</a></p>

<h1 id="toc_15">é¢œè‰²æ¨¡æ‹Ÿ</h1>

<p>ä¸Šé¢å†™åˆ°æˆ‘ä»¬éœ€è¦å±•ç¤º\(t_1â€‹\)çš„é¢œè‰²ï¼Œé‚£ä¹ˆ\(t_1â€‹\)éƒ½é¢œè‰²ç©¶ç«Ÿåº”è¯¥æ˜¯æ€æ ·çš„ï¼Ÿåº”è¯¥å°±æ˜¯å®ƒè‡ªèº«çš„é¢œè‰²å’Œå…‰ç›¸äº’ä½œç”¨çš„ç»“æœï¼Œæˆ‘ä»¬è¿™é‡Œå‘½äº‹ç‰©æœ¬èº«é¢œè‰²ä¸ºc, Pç‚¹å¤„å…‰çš„å¼ºåº¦ä¸ºiï¼ˆè¿™é‡Œæˆ‘ä»¬åªè€ƒè™‘ç™½å…‰ï¼‰ï¼Œ é‚£ä¹ˆæ¯”å¦‚ c * i å°±ä¼šæ˜¯æœ€ç»ˆçš„é¢œè‰²ï¼Œä¸€èˆ¬æ¥è¯´ 0 &lt; i &lt; 1ï¼Œæ¯”å¦‚ i æ˜¯ 0.5ï¼Œé‚£ä¹ˆç‰©ä½“å°±ä¼šå˜æˆåŸæ¥çš„ä¸€åŠäº®ã€‚</p>

<p>ä»¥ä¸‹çš„æ¨¡æ‹Ÿï¼Œæœ‰äº›ä¼šç”¨åˆ°è‡ªç„¶ç•Œä¸­å¯èƒ½äº‹ç‰©çš„çœŸå®æ ·å­ï¼Œæœ‰äº›å°±æ˜¯çº¯ç²¹çš„æ•°å­¦æ¨¡å‹ã€‚</p>

<h2 id="toc_16">1.å…‰æº</h2>

<h3 id="toc_17">1.1 ç¯å¢ƒå…‰</h3>

<p>ç¯å¢ƒå…‰å¾ˆç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥ç»™ä¸€ä¸ªæ•°å­—\(I_A\).è¿™æ ·å°±ä»£è¡¨äº†å‘¨å›´ç¯å¢ƒçš„å…‰</p>

<h3 id="toc_18">1.2 ç‚¹å…‰æº</h3>

<p>ç‚¹å…‰æºå°±åƒç”µç¯æ³¡ä¸€æ ·ï¼Œå›ºå®šäºä¸€ä¸ªç‚¹ï¼Œç„¶åå‘å‡ºå…‰çº¿äºå››å‘¨ï¼Œå¯¹äºç‚¹å…‰æºï¼Œæˆ‘ä»¬åªéœ€å®ƒçš„ä½ç½®Qå’Œå¼ºåº¦\(I_Qâ€‹\).</p>

<p><img src="images/point_light.png" alt=""></p>

<h3 id="toc_19">1.3 æ–¹å‘å…‰</h3>

<p>æ–¹å‘å…‰å°±ç±»ä¼¼äºè‡ªç„¶ç•Œä¸­çš„å¤ªé˜³å…‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å®ƒçš„æ–¹å‘\(\overrightarrow{L}\)å’Œå¼ºåº¦\(I_A\).</p>

<p><img src="images/directional_light.png" alt=""></p>

<h2 id="toc_20">2 å…‰ä¸ç‰©ä½“</h2>

<h3 id="toc_21">2.1 æ¼«åå°„</h3>

<p>æ¼«åå°„æ˜¯è¿™æ ·ï¼Œè¾¾åˆ°ç‰©ä½“è¡¨é¢çš„è¡¨é¢çš„å…‰å®é™…ä¸Šåªæœ‰\(\overrightarrow{QP}\) åœ¨\(\overrightarrow{TP}\) æ–¹å‘çš„æŠ•å½±,å®é™…ä¸ŠPç‚¹å¾—åˆ°çš„å¼ºåº¦æ˜¯\(I \cdot cos\alpha\).</p>

<p>æ³¨æ„æˆ‘ä»¬åªè€ƒè™‘\(cos\alpha\) å¤§äº0çš„çŠ¶å†µï¼Œå› ä¸ºå¦‚æœå°äºé›¶ï¼Œå®ƒæ˜¯åˆ°è¾¾äº†ç‰©ä½“çš„èƒŒé¢ã€‚</p>

<p><img src="images/diffuse_light.png" alt=""></p>

<p>\[
cos\alpha =  \frac{\overrightarrow{QP} \cdot \overrightarrow{TP}}{|\overrightarrow{QP}| \cdot |\overrightarrow{TP}|} 
\]</p>

<p>ä¸ºäº†è®¡ç®—æ–¹ä¾¿ï¼Œä»¤<strong>\(\overrightarrow{L}\)è¡¨ç¤ºæˆ‘ä»¬æŒ‡å‘å…‰æºçš„æ–¹å‘</strong>ï¼Œ\(\overrightarrow{N}\)ä¸ºç‰©ä½“è¡¨é¢çš„æ³•å‘é‡ï¼š</p>

<p><img src="images/diffuse2.png" alt=""></p>

<p>\[
cos\alpha =  \frac{\overrightarrow{L} \cdot \overrightarrow{N}}{|\overrightarrow{L}| \cdot |\overrightarrow{N}|} â€‹
\]</p>

<p>å¯ä»¥å¾—åˆ°å…‰å åŠ çš„æ•ˆæœæ˜¯ï¼š</p>

<p>\[
I = I_A + \displaystyle\sum_{i=1}^{n} I_i \frac{\overrightarrow{L_i} \cdot \overrightarrow{N}}{|\overrightarrow{L_i}| \cdot |\overrightarrow{N}|}
\]</p>

<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”»å‡ºç©ºé—´ä¸­å¾ˆå¥½çœ‹çš„æ•ˆæœäº†ã€‚æ³¨æ„å†æ¬¡æé†’è¿™é‡Œåé¢çš„å åŠ éƒ¨åˆ†åªéœ€è¦ç®—å¤§äº0çš„éƒ¨åˆ†ï¼Œå› ä¸ºå°äº0çš„å…‰å åŠ æ˜¯æ²¡æœ‰ç‰©ç†æ„ä¹‰çš„ã€‚</p>

<h2 id="toc_22">è‡³æ­¤ã®ä¼ªç </h2>

<h3 id="toc_23">è·Ÿè¸ªå…‰çº¿ä¸çƒç›¸äº¤ IntersectRaySphere</h3>

<p>è·Ÿä¹‹å‰å†™çš„ä¸€æ ·</p>

<h3 id="toc_24">t1 å¤„çš„å…‰ComputeLighting</h3>

<p>åœ¨ä»¥ä¸‹çš„ä¼ªç ä¸­ï¼ŒPæ˜¯ç‰©ä½“è¡¨é¢çš„ä½ç½®ï¼ŒNæ˜¯ç‰©ä½“è¡¨é¢çš„æ³•å‘é‡ã€‚</p>

<div><pre><code class="language-none">ComputeLighting(P, N) {
    i = 0.0
    for light in scene.Lights {
        if light.type == ambient {
            i += light.intensity
        } else {
            if light.type == point
                L = light.position - P
            else
                L = -light.direction

            n_dot_l = dot(N, L)
            if n_dot_l &gt; 0
                i += light.intensity*n_dot_l/(length(N)*length(L))
        }
    }
    return i
}</code></pre></div>

<h3 id="toc_25">t1 çš„é¢œè‰²TraceRay</h3>

<p>è¿™é‡Œæˆ‘ä»¬åœ¨ç©ºé—´é‡Œæ”¾å…¥å¥½å‡ ä¸ªçƒä½“ï¼Œç„¶åè®¡ç®—t1å¤„çš„é¢œè‰²ä¼ªç å¦‚ä¸‹ï¼š</p>

<div><pre><code class="language-none">TraceRay(O, D, t_min, t_max){
    closest_t = inf
    closest_sphere = NULL
    for sphere in scene.Spheres {
        t1, t2 = IntersectRaySphere(O, D, sphere)
        if t1 in [t_min, t_max] &amp;&amp; t1 &lt; closest_t
            closest_t = t1
            closest_sphere = sphere
        if t2 in [t_min, t_max] &amp;&amp; t2 &lt; closest_t
            closest_t = t2
            closest_sphere = sphere
    }

    if closest_sphere == NULL
        return BACKGROUND_COLOR
    
    P = O + closest_t * D #äº¤ç‚¹Pçš„ä½ç½®
    N = P - closest_sphere.center #è®¡ç®—På¤„çš„æ³•å‘é‡
    N = N / length(N) #normalize æ³•å‘é‡
    return closest_sphere.color * ComputeLighting(P, N)
}</code></pre></div>

<h3 id="toc_26">ç”»åˆ°ç”»å¸ƒä¸Š</h3>

<p>çœ‹ç»“æœï¼š</p>

<p><img src="images/raytracying02.png" alt=""></p>

<p>æ•ˆæœå·²ç»æ¯”ä¹‹å‰å¥½å¾ˆå¤šäº†ã€‚</p>

<p><a href="code/raytracying02.py">ä»£ç é“¾æ¥</a></p>

<h2 id="toc_27">é«˜å…‰</h2>

<p>é«˜å…‰</p>

<blockquote>
<p>æœ‰äº›ç‰©ä½“è¡¨é¢æ˜¯ä¸å…‰æ»‘çš„ï¼Œä½†æ˜¯å®ƒä»¬å…·æœ‰é«˜å…‰ã€‚æ¯”å¦‚æŠ›å…‰çš„ç“·ç –åœ°é¢ã€å…‰æ³½æ¶‚æ–™å’Œç™½æ¿ç­‰ã€‚é«˜å…‰åœ¨è¡¨é¢ä¸Šä¼šéšç€è§†ç‚¹çš„ç§»åŠ¨è€Œç§»åŠ¨ã€‚</p>
</blockquote>

<p>æ¯”å¦‚ä¸‹å›¾ï¼š</p>

<p><img src="images/highlight.jpg" alt=""></p>

<p>å›¾ä¸­ç™½è‰²çš„éƒ¨åˆ†å°±æ˜¯é«˜å…‰ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨ä¸åŒçš„è§’åº¦çœ‹å®ƒï¼Œå®ƒä¼šåœ¨ä¸åŒçš„ä½ç½®é«˜å…‰ã€‚</p>

<h3 id="toc_28">æ¨¡æ‹Ÿ</h3>

<p>é«˜å…‰ä¾é çš„å°±æ˜¯çº¯ç²¹çš„ä¸€ä¸ªæ•°å­¦æ¨¡æ‹Ÿã€‚å®ƒå…¶å®å°±æ˜¯ä¸€ä¸ªåå°„å…‰ã€‚</p>

<p><img src="images/specular_reflection.png" alt=""></p>

<p>LæŒ‡å‘å…‰æºï¼ŒNä¾æ—§ä¸ºæ³•å‘é‡ï¼ŒRä¸ºåå°„å½¢æˆçš„å…‰ï¼Œå®ƒæœ‰ç€è¿™æ ·çš„ç‰¹åˆ«ä¹‹å¤„ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬ä»è§‚å¯Ÿæ–¹å‘Væ¥çœ‹ï¼Œéšç€\(\alpha\)è§’åº¦çš„å¢å¤§ï¼Œè¿™ä¸ªå…‰ä¼šé”å‡çš„å¾ˆå¿«ã€‚</p>

<p>çœ‹å‡½æ•°\(cos\alpha\),å½“ \(\alpha\)ä¸º0çš„æ—¶å€™ï¼Œè¿™ä¸ªå€¼åˆšå¥½ä¸º1ï¼Œå½“\(\alpha\)å¢åŠ åˆ°90Â°æ—¶å€™ï¼Œè¿™ä¸ªå€¼åˆšå¥½å‡å°‘åˆ°0.</p>

<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨å‡½æ•°\(cos^s \alpha\)æ¥æ¨¡æ‹Ÿç‰©ä½“çš„é•œé¢æŒ‡æ•°ã€‚</p>

<p><img src="images/cosx.png" alt=""></p>

<p>é‚£ä¹ˆé«˜å…‰åå°„å°†ä¼šé€ æˆçš„\(\overrightarrow{R}\)åœ¨è§‚çœ‹è§’åº¦\(\overrightarrow{V}\)çš„å€¼çš„è®¡ç®—å¦‚ä¸‹ï¼š</p>

<p><img src="images/specular_reflection2.png" alt=""></p>

<p>\[
\overrightarrow{L_N} =\overrightarrow{N} ï¼ˆ\overrightarrow{L} \cdot \overrightarrow{N}ï¼‰
\]
\[
\overrightarrow{L_p} = \overrightarrow{L} - \overrightarrow{L_N}
\]
\[
\overrightarrow{R} = \overrightarrow{L_N} + (\overrightarrow{-L_P})
\]</p>

<p>ä»£å…¥å¯å¾—
\[
\overrightarrow{R} = 2 \cdot \overrightarrow{N} ï¼ˆ\overrightarrow{L} \cdot \overrightarrow{N}ï¼‰- \overrightarrow{L}
\]</p>

<p>æ‰€ä»¥ä»\(\overrightarrow{V}\)æ–¹å‘å¾—åˆ°çš„é«˜å…‰åå°„å…‰å¼ºåº¦æ˜¯ï¼š</p>

<p>\[
I_s = I_L(\frac{\overrightarrow{N} \cdot \overrightarrow{V}}{|\overrightarrow{N}| |\overrightarrow{V}|})^s
\]</p>

<p>ä¾æ—§è®°ä½æˆ‘ä»¬åªéœ€è¦è€ƒè™‘å¤§äº0çš„çŠ¶å†µ.</p>

<h2 id="toc_29">è‡³æ­¤ã®ä¼ªç </h2>

<p>ä¹‹å‰çš„ä¼ªç ä¾æ—§é€‚ç”¨ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘çš„æ˜¯ï¼š</p>

<ol>
<li>å¢åŠ é«˜å…‰æŒ‡æ•°s</li>
<li>è°ƒæ•´è®¡ç®—å…‰çš„éƒ¨åˆ†</li>
</ol>

<p>æˆ‘ä»¬é¦–å…ˆç»™æ¯ä¸ªå°çƒæ·»åŠ sï¼Œsè¶Šå¤§ä¼šè¶Šé—ªäº®(s = -1 è¡¨ç¤ºç‰©ä½“å¹¶æ²¡æœ‰)ï¼ŒæŒ‰ç…§ä½œè€…çš„é€»è¾‘ï¼ŒåŒæ—¶æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå·¨å¤§çš„å°çƒï¼Œè¿™æ ·å¥¹å°±ä¼šåƒä¸€ä¸ªå¹³é¢ä¸€æ ·ã€‚</p>

<p>åœ¨è®¡ç®—é«˜å…‰éƒ¨åˆ†çš„æ—¶å€™æˆ‘ä»¬ä½¿ç”¨ä¸Šæ–¹çš„å…¬å¼ï¼Œæˆ‘ä»¬å·²ç»æœ‰ \(\overrightarrow{N},\overrightarrow{L}ï¼Œ I_L\), sæ˜¯å°çƒæœ¬èº«çš„æ€§è´¨ï¼Œæˆ‘ä»¬ä¹Ÿå·²ç»æ·»åŠ ï¼Œéœ€è¦çš„è¿˜æœ‰\(\overrightarrow{V}\),è¿™æ˜¯æˆ‘ä»¬è§‚å¯Ÿçš„æ–¹å‘ï¼Œview directionï¼Œè®°ä½æˆ‘ä»¬å…‰çº¿è¿½è¸ªçš„åˆè¡·ï¼Œæ˜¯ä»çœ¼ç›çœ‹å‡ºæ¥ï¼Œæ‰€ä»¥view directionç‰¹åˆ«ç®€å•ï¼Œå°±æ˜¯\(-\overrightarrow{D}\).</p>

<p>æ‰€ä»¥è°ƒæ•´è®¡ç®—å…‰çš„éƒ¨åˆ†å¦‚ä¸‹</p>

<h3 id="toc_30">ComputeLighting</h3>

<div><pre><code class="language-none">ComputeLighting(P, N, V, s) {
    i = 0.0
    for light in scene.Lights {
        if light.type == ambient {
            i += light.intensity
        } else {
            if light.type == point
                L = light.position - P
            else
                L = light.direction
            
            # diffuse
            n_dot_l = dot(N, L)
            if n_dot_l &gt; 0
                i += light.intensity*n_dot_l/(length(N)*length(L))
            
            # specular
            if s!= -1 {
                  R = 2*N*dot(N,L) -L 
                  r_dot_v = dot(R, V)
                  if r_dot_v &gt; 0
                       i += light.intensity*pow(r_dot_v/length(R)*length(V)),s)
            }  
        }
    }
    return i
}</code></pre></div>

<h3 id="toc_31">TraceRay</h3>

<div><pre><code class="language-none">TraceRay(O, D, t_min, t_max){
    closest_t = inf
    closest_sphere = NULL
    for sphere in scene.Spheres {
        t1, t2 = IntersectRaySphere(O, D, sphere)
        if t1 in [t_min, t_max] &amp;&amp; t1 &lt; closest_t
            closest_t = t1
            closest_sphere = sphere
        if t2 in [t_min, t_max] &amp;&amp; t2 &lt; closest_t
            closest_t = t2
            closest_sphere = sphere
    }

    if closest_sphere == NULL
        return BACKGROUND_COLOR
    
    P = O + closest_t * D #äº¤ç‚¹Pçš„ä½ç½®
    N = P - closest_sphere.center #è®¡ç®—På¤„çš„æ³•å‘é‡
    N = N / length(N) #normalize æ³•å‘é‡
    return closest_sphere.color * ComputeLighting(P, N, -D, sphere.specular)
}</code></pre></div>

<h3 id="toc_32">ç”»åˆ°ç”»å¸ƒä¸Š</h3>

<p>çœ‹ç»“æœï¼š</p>

<p><img src="images/raytracying03.png" alt=""></p>

<p><a href="code/raytracying03.py">ä»£ç é“¾æ¥</a></p>

<h2 id="toc_33">é˜´å½±</h2>

<p>æˆ‘ä»¬è¿½è¸ªä¸€æ¡å…‰çº¿ï¼Œè€ƒè™‘å®ƒç¢°åˆ°çš„ç‰©ä½“ï¼Œè€ƒè™‘å…‰ç¢°åˆ°ç‰©ä½“è¡¨é¢å‘ç”Ÿçš„æ¼«åå°„å’Œé•œé¢åå°„ã€‚</p>

<p>åœ¨è€ƒè™‘äº†è¿™äº›é—®é¢˜ä»¥ä¸Šï¼Œæˆ‘ä»¬è¿˜æœ‰å¹¶æ²¡æœ‰è€ƒè™‘åˆ°çš„é—®é¢˜--å½±ã€‚</p>

<p>å½±å­è¯´èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“è€ƒè™‘ï¼Œå°±æ˜¯å¦‚æœåœ¨æŸç‚¹ä¸å…‰ä¹‹é—´æœ‰ç‰©ä½“é˜»ç¢çš„è¯ï¼Œé‚£ä¹ˆè¿™ç‚¹å°†æ˜¯æ²¡æœ‰å…‰çš„ï¼Œå¦åˆ™è¿™ç‚¹æ˜¯è¢«ç‚¹äº®çš„ã€‚</p>

<p><img src="images/shadow.png" alt=""></p>

<h3 id="toc_34">æ–¹å‘å…‰</h3>

<p>æˆ‘ä»¬ä¾æ—§ç”¨Læ¥æŒ‡å‘å…‰æºï¼Œè€ƒè™‘æˆ‘ä»¬æƒ³ç ”ç©¶çš„Pç‚¹çŠ¶å†µï¼š</p>

<p><img src="images/directional_shadow.png" alt=""></p>

<p>å¯¹äºPç‚¹æ¥è¯´ï¼Œç”±å®ƒå‡ºå‘æŒ‡å‘æ–¹å‘å…‰çš„è·¯ä¸Šå¦‚æœç¢°åˆ°é˜»ç¢ï¼Œé‚£ä¹ˆå°±è¯´æ˜Pç‚¹åº”è¯¥ä¸ºæš—ï¼Œå¦åˆ™Pç‚¹ä¸ºäº®ã€‚</p>

<p>è¿™é‡Œå®é™…ä¸Šæˆ‘ä»¬ä¾æ—§æœ‰å·¥å…·æ¥è®¡ç®—ä¸€æ¡å°„çº¿ä¸çƒçš„æœ€è¿‘ç›¸äº¤ç‚¹äº†ï¼Œæ‰€ä»¥å·¥å…·å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œè¿™é‡Œçš„ \(t_{min} = 0, t_{max} = +âˆ\)</p>

<h3 id="toc_35">ç‚¹å…‰æº</h3>

<p>å¯¹äºç‚¹å…‰æºæ¥è¯´</p>

<p><img src="images/point_shadow.png" alt=""></p>

<p>æŒ‡å‘å…‰æºçš„Læˆ‘ä»¬å¾ˆå®¹æ˜“æˆ‘ä»¬ä¹Ÿå®¹æ˜“æ±‚å¾—ï¼Œæ˜¯\(Q - P\)ï¼Œ ä¸è¿‡è¿™é‡Œå¯¹åº”çš„ \(t_{min} = 0, t_{max} = 1\)ï¼Œå› ä¸ºåˆ«å¿˜äº†æˆ‘ä»¬çš„Læ˜¯ç”¨æ¥æŒ‡å‘å…‰æºçš„ï¼Œ \(t_{min} = 0\) å°±æ˜¯ç‰©ä½“æœ¬èº«æ‰€å¤„ä½ç½®ï¼Œ \(t_{max} = 1\)å°±æ˜¯ç‚¹å…‰æºæ‰€åœ¨ä½ç½®ã€‚</p>

<p>è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬éœ€è¦å½“ t = 0 æ—¶ï¼Œå®é™…ä¸Šç‰©ä½“ä¼šåœ¨å®ƒæœ¬èº«ä¸Šç•™ä¸‹é˜´å½±ï¼Œæ‰€ä»¥æˆ‘ä»¬å–ä¸€ä¸ªæå°çš„tå€¼ï¼Œæ¯”å¦‚ t = 0.001 æ¥å¤„ç†è¿™ç§çŠ¶å†µã€‚</p>

<h3 id="toc_36">ç¯å¢ƒå…‰</h3>

<p>è‡³äºç¯å¢ƒç®¡ï¼Œå®ƒæ˜¯å‡åŒ€åˆ†å¸ƒçš„ï¼Œå°±ä¸ç”¨è€ƒè™‘å®ƒäº†ã€‚</p>

<h3 id="toc_37">è‡³æ­¤ã®ä¼ªç </h3>

<h3 id="toc_38">ClosestIntersection</h3>

<p>è¿™æ˜¯æå–å‡ºæ¥ï¼Œæˆ‘ä»¬ç”¨æ¥ç®—ä»æŸç‚¹å°„å‡ºå°„çº¿Dåœ¨ç»™å®š t<em>min, t</em>max çš„æƒ…å†µä¸‹è·Ÿçƒçš„ç›¸äº¤å’Œæœ€è¿‘çš„äº¤ç‚¹ã€‚</p>

<div><pre><code class="language-none">ClosestIntersection(O, D, t_min, t_max){
    closest_t = inf
    closest_sphere = NULL
    for sphere in scene.Spheres {
        t1, t2 = IntersectRaySphere(O, D, sphere)
        if t1 in [t_min, t_max] &amp;&amp; t1 &lt; closest_t
            closest_t = t1
            closest_sphere = sphere
        if t2 in [t_min, t_max] &amp;&amp; t2 &lt; closest_t
            closest_t = t2
            closest_sphere = sphere
    }

    return closest_sphere, closest_t 
}</code></pre></div>

<h3 id="toc_39">TraceRay</h3>

<p>TraceRayä¾æ—§ä¸å˜ï¼Œä¾æ—§æ˜¯ç®—çš„è¿™æ¡å…‰çº¿åº”è¯¥çœ‹åˆ°çš„é¢œè‰²ã€‚</p>

<div><pre><code class="language-none">TraceRay(O, D, t_min, t_max){
    closest_sphere , closest_t = ClosestIntersection(O, D, t_min, t_max)
    
    if closest_sphere == NULL
        return BACKGROUND_COLOR
    
    P = O + closest_t * D #äº¤ç‚¹Pçš„ä½ç½®
    N = P - closest_sphere.center #è®¡ç®—På¤„çš„æ³•å‘é‡
    N = N / length(N) #normalize æ³•å‘é‡
    return closest_sphere.color * ComputeLighting(P, N, -D, sphere.specular)
}</code></pre></div>

<h3 id="toc_40">ComputeLighting</h3>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬å¢åŠ äº†æ£€æŸ¥é˜´å½±çš„éƒ¨åˆ†ï¼Œå¦‚æœæˆ‘ä»¬ä¸­é—´ç¢°åˆ°äº†é˜»ç¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸ç”¨è®¡ç®—å…‰äº†ï¼Œå®ƒå°±æ˜¯æš—è‰² i = 0,å¦åˆ™æˆ‘ä»¬æ‰è®¡ç®—å“åº”çš„é¢œè‰²ï¼Œè¿™é‡Œè¿˜é‡‡ç”¨äº† 0.001 æ¥é¿å…ç‰©ä½“åœ¨å…¶è‡ªèº«çš„è¡¨é¢å½¢æˆé˜´å½±ã€‚</p>

<div><pre><code class="language-none">ComputeLighting(P, N, V, s) {
    i = 0.0
    for light in scene.Lights {
        if light.type == ambient {
            i += light.intensity
        } else {
            if light.type == point {
                L = light.position - P
                t_max = 1
            }
            else {
                L = light.direction
                t_max = inf   
            }
            
            # shadow check
            shadow_sphere, shadow_t = ClosestIntersection(P, L, 0.001, t_max)
            if shadow_sphere != NULL
                    continue
            
            # diffuse
            n_dot_l = dot(N, L)
            if n_dot_l &gt; 0
                i += light.intensity*n_dot_l/(length(N)*length(L))
            
            # specular
            if s!= -1 {
                  R = 2*N*dot(N,L) -L 
                  r_dot_v = dot(R, V)
                  if r_dot_v &gt; 0
                       i += light.intensity*pow(r_dot_v/length(R)*length(V)),s)
            }  
        }
    }
    return i
}</code></pre></div>

<h3 id="toc_41">ç”»åˆ°ç”»å¸ƒä¸Š</h3>

<p>çœ‹ç»“æœï¼š</p>

<p><img src="images/raytracying04.png" alt=""></p>

<p><a href="code/raytracying04.py">ä»£ç é“¾æ¥</a></p>

<h2 id="toc_42">é•œé¢åå°„</h2>

<p>ç‰©ä½“å½“ç„¶ä¹Ÿå¯ä»¥åƒé•œå­ä¸€æ ·ï¼Œæˆ‘ä»¬èƒ½é€è¿‡çœ‹å®ƒçœ‹åˆ°å‘¨å›´çš„ç‰©ä½“ã€‚</p>

<h3 id="toc_43">é«˜å…‰ VS é•œå­æ•ˆæœ</h3>

<p>é«˜å…‰æ˜¯è¿™æ ·ï¼š</p>

<p><img src="images/eye_specular.png" alt=""></p>

<p>æˆ‘ä»¬åœ¨çœ¼ç›è¿™é‡Œçœ‹åˆ°çš„ä¾æ—§æ˜¯è“è‰²ï¼Œè¿™ä¸ª\(\alpha\)è¶Šå¤§ï¼Œçœ‹åˆ°çš„è¶Šæš—ï¼Œ\(\alpha = 0\)åˆ™è“è‰²æœ€å¼ºã€‚</p>

<p>é•œé¢åå°„åˆ™æ˜¯è¿™æ ·ï¼š</p>

<p><img src="images/eye_mirror.png" alt=""></p>

<p>çœ‹ä¸‹é¢å¤ªé˜³â˜€ï¸ï¼Œè¿™æ‰æ˜¯é•œå­çš„åå°„æ•ˆæœï¼Œæˆ‘ä»¬çœ¼ç›çœ‹åˆ°çš„åˆ™ä¸æ˜¯è“è‰²çš„å…‰ï¼Œè€Œæ˜¯ç‰©ä½“ä½œä¸ºé•œå­ï¼Œåå°„çš„å¤ªé˜³ã€‚</p>

<p>æ‰€ä»¥æ·»åŠ ä¸Šé•œå­çš„æ•ˆæœä¹‹åï¼Œæ­¤æ—¶çœ¼ç›çœ‹åˆ°çš„é¢œè‰²æ˜¯æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„ æ¼«åå°„ï¼Œé«˜å…‰ ä»¥åŠ é•œå­æ•ˆæœåå°„çš„åŸå§‹ç‰©ä½“çš„é¢œè‰²ã€‚</p>

<h3 id="toc_44">TraceRay</h3>

<p>å…ˆæ¥çœ‹é•œå­åå°„çš„æ•ˆæœ</p>

<p><img src="images/mirror.png" alt=""></p>

<p>è¿˜è®°å¾—ä¹‹å‰çš„å›¾å’Œå¼å­ï¼š</p>

<p><img src="images/specular_reflection2.png" alt=""></p>

<p>\[
\overrightarrow{R} = 2 \cdot \overrightarrow{N} ï¼ˆ\overrightarrow{L} \cdot \overrightarrow{N}ï¼‰- \overrightarrow{L}
\]</p>

<p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬ä¾æ—§ç”¨ \(\overrightarrow{R}\) æŒ‡å‘å…‰çº¿æ¥çš„æ–¹å‘ï¼Œé‚£ä¹ˆæŒ‡å‘åå°„æ–¹å‘çš„\(\overrightarrow{R&#39;}\) ä¸ºï¼š</p>

<p><img src="images/mirror_r.png" alt=""></p>

<p>\[
\overrightarrow{R&#39;} = 2 \cdot \overrightarrow{R} ï¼ˆ\overrightarrow{R} \cdot \overrightarrow{N}ï¼‰- \overrightarrow{R}
\]</p>

<p>å¯¹äºæˆ‘ä»¬å…‰çº¿è¿½è¸ªæ¥è¯´ï¼Œç‰¹æ®Šä¹‹å¤„å°±åœ¨äºæˆ‘ä»¬çš„ TraceRay(O, D, t_min, t_max) å‡½æ•°æ˜¯ç”¨æ¥è®¡ç®—ä» O å‡ºå‘çš„å°„çº¿ Dï¼Œ åœ¨ç»™å®š t_min å’Œ t_max æ—¶ä¼šçœ‹åˆ°çš„é¢œè‰²ï¼Œæ‰€ä»¥å®é™…ä¸Šå¦‚æœæˆ‘ä»¬è·Ÿè¸ªçš„å…‰çº¿å¦‚æœåˆ°è¾¾æŸä¸ªé•œå­åå°„çš„è¡¨é¢ã€‚é‚£ä¹ˆè®¡ç®—çš„ä¹Ÿå°±æ˜¯åå°„å®ƒåº”å½“æœ‰çš„é¢œè‰²ï¼š</p>

<p><img src="images/reflected_traceray.png" alt=""></p>

<p>è€Œè¿™æ ·è®¡ç®—åˆåˆšå¥½æ˜¯ TraceRay å‡½æ•°åœ¨åšçš„äº‹ï¼Œ ä»æŸç‚¹å‡ºå‘ï¼Œç»™å®šå…‰çº¿ï¼ˆå°„çº¿ï¼‰çš„æ–¹å‘ï¼Œç»™å®št_min, t_max. æ¥è®¡ç®—å®ƒåº”å½“æœ‰çš„é¢œè‰²ï¼Œè¿™æ ·æˆ‘ä»¬ä¸ç”¨å†™ä»»ä½•æ–°çš„å‡½æ•°ï¼Œå†æ¬¡è°ƒç”¨TraceRayå‡½æ•°ï¼Œç›®çš„è¾¾åˆ°ã€‚</p>

<p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªé€’å½’çš„é—®é¢˜ï¼Œå°±åƒä¸¤ä¸ªæ­£å¯¹ç€æ”¾çš„é•œå­ä¸€æ ·ï¼Œå®ƒä»¬éƒ½ä¼šæ— æ­¢å°½çš„äº’ç›¸åå°„å¯¹æ–¹ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è®¾å®šä¸€ä¸ªé€’å½’çš„ç³»æ•°ã€‚</p>

<ul>
<li>r = 0: æ²¡æœ‰é•œå­æ•ˆæœ</li>
<li>r = 1: ç‰©ä½“å’Œç‰©ä½“çš„åå°„</li>
<li>r = 2: ç‰©ä½“å’Œç‰©ä½“çš„åå°„å’Œç‰©ä½“åå°„çš„åå°„</li>
</ul>

<p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šè®© r &gt; 3.</p>

<h2 id="toc_45">è‡³æ­¤ã®ä¼ªç </h2>

<p>æˆ‘ä»¬éœ€è¦æ·»åŠ ï¼š</p>

<ul>
<li>ç‰©ä½“çš„åå°„ç³»æ•°</li>
<li>è®¡ç®—Rçš„åå°„å…‰çº¿</li>
<li>æŠŠè¿™ä¸ªåŠ å…¥åŸæœ¬çš„TraceRayä¸­</li>
</ul>

<h3 id="toc_46">ReflectRay</h3>

<div><pre><code class="language-none">ReflectRay(R, N) {
    return 2*N*dot(N, R) - R
}</code></pre></div>

<h3 id="toc_47">TraceRay</h3>

<div><pre><code class="language-none">TraceRay(O, D, t_min, t_max, depth){
    closest_sphere , closest_t = ClosestIntersection(O, D, t_min, t_max)

    if closest_sphere == NULL
        return BACKGROUND_COLOR

    # local color
    P = O + closest_t * D #äº¤ç‚¹Pçš„ä½ç½®
    N = P - closest_sphere.center #è®¡ç®—På¤„çš„æ³•å‘é‡
    N = N / length(N) #normalize æ³•å‘é‡
    local_color = closest_sphere.color * ComputeLighting(P, N, -D, sphere.specular)

    # If we hit the recursion limit or the object is not reflective, we&#39;re done
    r = closest_sphere.reflective
    if depth &lt;= 0 or r &lt;= 0:
        return local_color

    # reflected color
    R = ReflectRay(-D, N)
    reflected_color = TraceRay(P, R, 0.001, inf, depth - 1)

    return local_color * (1 - r) + reflected_color*r
}</code></pre></div>

<p>è¿™é‡Œé¢ä¸»è¦æ›´æ–°çš„éƒ¨åˆ†åœ¨è¿™å‡ å¥ï¼š</p>

<div><pre><code class="language-none">    # If we hit the recursion limit or the object is not reflective, we&#39;re done
    r = closest_sphere.reflective
    if depth &lt;= 0 or r &lt;= 0:
        return local_color

    # reflected color
    R = ReflectRay(-D, N)
    reflected_color = TraceRay(P, R, 0.001, inf, depth - 1)

    return local_color * (1 - r) + reflected_color*r</code></pre></div>

<p>è€Œæˆ‘çš„é‡ç‚¹æ˜¯åœ¨ï¼š</p>

<ol>
<li>ReflectRayä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å–å¾—æŒ‡å‘å°„å…¥å°„çº¿çš„é˜²çº¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å–-D</li>
<li>æˆ‘ä»¬æ˜¯ä»Pç‚¹å¼€å§‹ï¼Œç„¶åæœç€Ræ–¹å‘çœ‹å‡ºå»ï¼ŒåŒæ ·è¿™é‡Œæˆ‘ä»¬ä¸å¸Œæœ›ç‰©ä½“é•œé¢æ•ˆæœä»–ä»¬æœ¬èº«ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™t_minä¸€ä¸ªæå°å€¼</li>
<li>å½“ç„¶ä¹Ÿå¦‚åŒä¹‹å‰æåˆ°ï¼Œç»™è¿™ä¸ªé€’å½’å‡½æ•°äº†é€’å½’æ·±åº¦ä»¥é˜²æ­¢å®ƒæ— é™å¾ªç¯</li>
<li>æœ€åé‡‡ç”¨é¢œè‰²å åŠ æ¥å¾—åˆ°æœ€ç»ˆçš„é¢œè‰²</li>
</ol>

<p>å½“ç„¶ä¹Ÿéœ€è¦æŠŠ ä¸»å¾ªç¯ä¸­çš„ color æ›´æ–°</p>

<div><pre><code class="language-none">color = TraceRay(O, D, 1, inf, recusion_depth)</code></pre></div>

<h3 id="toc_48">ç”»åˆ°ç”»å¸ƒä¸Š</h3>

<p>çœ‹ç»“æœï¼š</p>

<p><img src="images/raytracying05_r3.png" alt=""></p>

<p>è¿™æ˜¯r = 3, å¯ä»¥çœ‹åˆ°ç‰©ä½“åå°„åå°„å†åå°„çš„çŠ¶å†µã€‚ä¹Ÿå¯ä»¥æŠŠ r è°ƒæ•´ä¸º1æ¥çœ‹ä¸åŒçš„æƒ…å†µã€‚</p>

<p><img src="images/raytracying05_r1.png" alt=""></p>

<p>å¯ä»¥æ˜æ˜¾çœ‹åˆ°ä½œä¸ºé•œå­ï¼Œåå°„æƒ…å†µçš„ä¸åŒã€‚</p>

<p><a href="code/raytracying05.py">ä»£ç é“¾æ¥</a></p>

<h2 id="toc_49">å…‰çº¿è¿½è¸ªæ€»ç»“</h2>

<p>é™¤äº†åˆšæ‰è®¨è®ºè¿‡çš„ï¼Œå…³äºå…‰çº¿è¿½è¸ªè¿˜æœ‰å¾ˆå¤šè¯é¢˜ï¼š ä¼˜åŒ–ï¼ŒæŠ˜å°„ã€‚æœ€ç»ˆå†æ¢³ç†ä¸€éè‡³ä»Šã®æ‰€æœ‰ä¼ªç ã€‚</p>

<div><pre><code class="language-none">CanvasToViewport(x, y){
    return (x * Vw/Cw, y * Vh/Ch, d)
}

ReflectRay(R, N) {
    return 2*N*dot(N, R) - R
}

ComputeLighting(P, N, V, s) {
    i = 0.0
    for light in scene.Lights {
        if light.type == ambient {
            i += light.intensity
        } else {
            if light.type == point {
                L = light.position - P
                t_max = 1
            }
            else {
                L = light.direction
                t_max = inf   
            }
            
            # shadow check
            shadow_sphere, shadow_t = ClosestIntersection(P, L, 0.001, t_max)
            if shadow_sphere != NULL
                    continue
            
            # diffuse
            n_dot_l = dot(N, L)
            if n_dot_l &gt; 0
                i += light.intensity*n_dot_l/(length(N)*length(L))
            
            # specular
            if s!= -1 {
                  R = 2*N*dot(N,L) -L 
                  r_dot_v = dot(R, V)
                  if r_dot_v &gt; 0
                       i += light.intensity*pow(r_dot_v/length(R)*length(V)),s)
            }  
        }
    }
    return i
}

ClosestIntersection(O, D, t_min, t_max){
    closest_t = inf
    closest_sphere = NULL
    for sphere in scene.Spheres {
        t1, t2 = IntersectRaySphere(O, D, sphere)
        if t1 in [t_min, t_max] &amp;&amp; t1 &lt; closest_t
            closest_t = t1
            closest_sphere = sphere
        if t2 in [t_min, t_max] &amp;&amp; t2 &lt; closest_t
            closest_t = t2
            closest_sphere = sphere
    }

    return closest_sphere, closest_t 
}

TraceRay(O, D, t_min, t_max, depth){
    closest_sphere , closest_t = ClosestIntersection(O, D, t_min, t_max)

    if closest_sphere == NULL
        return BACKGROUND_COLOR

    # local color
    P = O + closest_t * D #äº¤ç‚¹Pçš„ä½ç½®
    N = P - closest_sphere.center #è®¡ç®—På¤„çš„æ³•å‘é‡
    N = N / length(N) #normalize æ³•å‘é‡
    local_color = closest_sphere.color * ComputeLighting(P, N, -D, sphere.specular)

    # If we hit the recursion limit or the object is not reflective, we&#39;re done
    r = closest_sphere.reflective
    if depth &lt;= 0 or r &lt;= 0:
        return local_color

    # reflected color
    R = ReflectRay(-D, N)
    reflected_color = TraceRay(P, R, 0.001, inf, depth - 1)

    return local_color * (1 - r) + reflected_color*r
}

O = &lt;0,0,0&gt;

for x in [-Cw/2, Cw/2]{
    for y in [-Ch/2, Ch/2]{
        D = CanvasToViewport(x, y)
        color = TraceRay(O, D, t_min, t_max)
        canvas.putPixel(x, y, color)
    }
}</code></pre></div>

<p>è¿™æ˜¯æ‰€ç”¨çš„æ‰€æœ‰å‚æ•°ï¼š</p>

<div><pre><code class="language-none">viewport_size = 1 x 1
projection_plane_d = 1

sphere {
    center = (0, -1, 3)
    radius = 1
    color = (255, 0, 0)  # Red
    specular = 500  # Shiny
    reflective = 0.2  # A bit reflective
}
sphere {
    center = (-2, 1, 3)
    radius = 1
    color = (0, 0, 255)  # Blue
    specular = 500  # Shiny
    reflective = 0.3  # A bit more reflective
}
sphere {
    center = (2, 1, 3)
    radius = 1
    color = (0, 255, 0)  # Green
    specular = 10  # Somewhat shiny
    reflective = 0.4  # Even more reflective
}
sphere {
    color = (255, 255, 0)  # Yellow
    center = (0, -5001, 0)
    radius = 5000
    specular = 1000  # Very shiny
    reflective = 0.5  # Half reflective
}


light {
    type = ambient
    intensity = 0.2
}
light {
    type = point
    intensity = 0.6
    position = (2, 1, 0)
}
light {
    type = directional
    intensity = 0.2
    direction = (1, 4, 4)
}</code></pre></div>

<h1 id="toc_50">ç”»çº¿</h1>

<p>æˆ‘ä»¬å…ˆä»å±å¹•ç”»çº¿å¼€å§‹ã€‚</p>

<p>é¦–å…ˆï¼Œ<code>y = ax + b</code> è¿™ä¸ªå¹¶ä¸èƒ½ç”»å‡ºæ‰€æœ‰çš„çº¿ï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p>

<ul>
<li>å¦‚æœaå¾ˆå¤§ï¼Œé‚£ä¹ˆxç”± \(x_0\) å¢åŠ åˆ° \(x_0+1\) é‚£ä¹ˆyå¢åŠ aï¼Œå¦‚æœ a å¾ˆå¤§ï¼Œé‚£ä¹ˆä¼šæœ‰åˆ†è£‚çš„æ ·å¼</li>
</ul>

<p><img src="images/line_01.png" alt=""></p>

<ul>
<li>æ— æ³•ç”»å‡ºå¹³è¡Œäº y çš„ç«–çº¿</li>
</ul>

<p><img src="images/line_02.png" alt=""></p>

<p>é’ˆå¯¹è¿™ç§çŠ¶å†µï¼Œæˆ‘ä»¬é‡‡ç”¨çš„ç”»å›¾æ–¹å¼æ˜¯åˆ©ç”¨å¦‚ä¸‹çš„ä»£ç ï¼š</p>

<div><pre><code class="language-none">Interpolate (i0, d0, i1, d1){
    if i0 == i1 {
        return [d0]    
    }
    values = []
    a = (d1 - d0) / (i1 - i0)
    d = d0
    for i = i0 to i1{
        values.append(d)
        d = d + a
    } 
    return values
}</code></pre></div>

<p>é¦–å…ˆæ˜¯æˆ‘ä»¬åˆ©ç”¨çš„æ˜¯è¦ä¹ˆ <code>y = ax + b</code> , è¦ä¹ˆ <code>x = ay + b</code>, æ„æ€æ˜¯è¦ä¹ˆæˆ‘ä»¬è®© y éšç€ x å˜åŒ–ï¼Œè¦ä¹ˆè®© x éšç€ y å˜åŒ–. åœ¨ä¸Šè¿°çš„ä¼ªç ä¸­ï¼Œæˆ‘ä»¬çš„ d æ˜¯ dependent valueï¼Œ i æ˜¯ independent valueï¼Œæˆ‘ä»¬è®© d éšç€ i å˜åŒ–ã€‚</p>

<p>å…¶æ¬¡æ˜¯æˆ‘ä»¬åˆ†æƒ…å†µï¼Œçœ‹çº¿æ˜¯æ›´åŠ æ°´å¹³æˆ–è€…æ˜¯æ›´åŠ ç«–ç›´ï¼Œå¦‚æœçº¿æ›´åŠ æ°´å¹³ï¼Œé‚£ä¹ˆ y éšç€xå˜åŒ–ï¼Œå¦‚æœæ›´ç«–ç›´ï¼Œé‚£ä¹ˆx éšç€yå˜åŒ–ï¼Œè¿™æ ·æ¥ä½œå›¾ã€‚</p>

<div><pre><code class="language-none">DrawLine(P0, P1, color) {
    if abs(x1 - x0) &gt; abs(y1 -y0){
        # Line is horizontal-ish
        # Make sure x0 &lt; x1
        if x0 &gt; x1 {
            swap(P0, P1)
        }
        ys = Interpolate(x0, y0, x1, y1)
        for x = x0 to x1{
            canvas.PutPixel(x, ys[x-x0], color)
        }
    } else {
        # Line is vertical-ish
        # Make sure y0 &lt; y1
        if y0 &gt; y1 {
            swap(P0,P1)
        }
        xs = Interpolate(y0, x0, y1, x1)
        for y = y0 to y1{
            canvas.PutPixel(xs[y-y0], y, color)
        }
    }
}</code></pre></div>

<h2 id="toc_51">ç”»å‡ºæ¥</h2>

<p><img src="images/raster01.png" alt=""></p>

<p><a href="code/raster01.py">ä»£ç </a></p>

<h1 id="toc_52">ç”»ä¸‰è§’å½¢</h1>

<p>å¦‚æœæˆ‘ä»¬åªæ˜¯ç”»ä¸€ä¸ªä¸‰è§’å½¢çš„æ¡†æ¶å¾ˆç®€å•ï¼š</p>

<div><pre><code class="language-none">DrawWireframeTriangle( P0, P1, P2, color){
    DrawLine(P0, P1, color);
    DrawLine(P1, P2, color);
    DrawLine(P2, P0, color);
}</code></pre></div>

<p>åƒè¿™æ ·ï¼š</p>

<p><img src="images/triangle01.png" alt=""></p>

<p>ä¸è¿‡å¦‚æœæˆ‘ä»¬æƒ³ç»™è¿™ä¸ªä¸‰è§’å½¢å¡«è‰²å¥½åƒå°±éœ€è¦ä¸€ç‚¹æ€è€ƒï¼Œä¸€ä¸ªæœ€ç®€å•çš„æƒ³æ³•å°±æ˜¯å¯¹äºæ¯ä¸ªyå€¼æˆ‘ä»¬æ‰¾å‡ºè¿™ä¸ªä¸‰è§’å½¢å¯¹åº”çš„xå€¼ x_left å’Œ x_rightï¼Œç„¶åç”»ä¸€æ¡ x_left åˆ° x_right çš„çº¿ã€‚</p>

<div><pre><code class="language-none">for each horizontal line y occupied by the triangle
    compute x_left and x_right for this y
    DrawLine(x_left, y, x_right, y)</code></pre></div>

<p>é¦–å…ˆæˆ‘ä»¬æ¥ä¿è¯ä¸‰ä¸ªç‚¹çš„çºµåæ ‡æ˜¯\(P_0, P_1, P_2\)æ–¹å‘å¢å¤§çš„ï¼Œæœ‰\(y_0 \leq y_1 \leq y_2\). æ‰€ä»¥è¿™æ ·æˆ‘ä»¬å¯ä»¥çŸ¥é“ y çš„èŒƒå›´æ˜¯ \([y_0, y_2]\)ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç è¾¾åˆ°ï¼š</p>

<div><pre><code class="language-none">if y1 &lt; y0 { swap(p1, p0) }
if y2 &lt; y0 { swap(p2, p0) }
if y2 &lt; y1 { swap(p2, p1) }</code></pre></div>

<p>ç„¶åæˆ‘ä»¬å†æ¥è®¡ç®— x_left å’Œ x_rightï¼Œå› ä¸º\(P_0P_2\) æ˜¯ä¸€æ¡é•¿è¾¹ï¼Œé‚£ä¹ˆä¸¤æ¡çŸ­çš„è¾¹å°±æ˜¯\(P_0 P1\) å’Œ\(P_1 P2\)ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å¾—åˆ°è¿™ä¸‰æ¡è¾¹çš„xéšç€yçš„å˜åŒ–ï¼š</p>

<div><pre><code class="language-none">x01 = Interpolate(y0, x0, y1, x1)
x12 = Interpolate(y1, x1, y2, x2)
x02 = Interpolate(y0, x0, y2, x2)</code></pre></div>

<p>æ³¨æ„è¿™é‡Œç®—çš„æ˜¯ä¸€ä¸ªæ•°ç»„[ ],æ˜¯ x éšç€yå€¼çš„å˜åŒ–çš„æ•°ç»„ã€‚</p>

<p>x02 ä¸€å®šæ˜¯ x_left æˆ–è€… x_rightï¼Œ å¦å¤–ä¸€è¾¹å°†æ˜¯ x01 å’Œ x12 çš„ç»„åˆã€‚</p>

<p>åŒæ—¶æˆ‘ä»¬æ³¨æ„æœ‰ä¸€ä¸ªé‡å¤çš„å€¼ï¼Œå°±æ˜¯åœ¨ \(P_1\) å¤„ï¼Œæ‰€ä»¥ï¼š</p>

<div><pre><code class="language-none">remove_last(x01)
x012 = x01 + x12</code></pre></div>

<p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº† x02 å’Œ x012ï¼Œ å†³å®šx_left å’Œ x_rightçš„æ—¶åˆ»åˆ°äº†ï¼Œæˆ‘ä»¬å°±ç›´æ¥çœ‹æœ€ç»ˆçš„è°å¤§è°å°å°±å¯ä»¥å†³å®šå·¦å³äº†ï¼š</p>

<div><pre><code class="language-none">m = x02.length/2
if x02[m] &lt; x012[m]{
    x_left = x02
    x_right = x012
} else {
    x_left = x012
    x_right = x02
}</code></pre></div>

<p>æœ€ç»ˆæˆ‘ä»¬å¯ä»¥å¾—åˆ° DrawFilledTriangleçš„ä¼ªç ï¼š</p>

<div><pre><code class="language-none">DrawFilledTriangle(P0, P1, P2, color){
    # sort the points so that y0 â‰¤ y1 â‰¤ y2
    if y1 &lt; y0 { swap(p1, p0) }
    if y2 &lt; y0 { swap(p2, p0) }
    if y2 &lt; y1 { swap(p2, p1) }
    
    # compute the x coordinates of the triangle edges
    x01 = Interpolate(y0, x0, y1, x1)
    x12 = Interpolate(y1, x1, y2, x2)
    x02 = Interpolate(y0, x0, y2, x2)
    
    # concatenate the short sides
    remove_last(x01)
    x012 = x01 + x12
    
    # determine which is left and which is right
    m = x02.length/2
    if x02[m] &lt; x012[m]{
        x_left = x02
        x_right = x012
    } else {
        x_left = x012
        x_right = x02
    }
    
    
    # draw the horizontal segments
    for y = y0 to y2 {
        for x = x_left[y - y0] to x_right[y - y0]{
            canvas.putPixel(x, y, color)
        }
    }
}
</code></pre></div>

<h2 id="toc_53">ç»“æœ</h2>

<p>çœ‹æ•ˆæœï¼š</p>

<p><img src="images/raster02.png" alt=""></p>

<p><a href="raster02.py">ä»£ç é“¾æ¥</a></p>

<h1 id="toc_54">æ¸å˜ä¸‰è§’å½¢</h1>

<p>è¿™é‡Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªhï¼Œç”¨æ¥è¡¨ç¤ºæ¯ä¸ªé¡¶ç‚¹çš„é¢œè‰²æµ“åº¦</p>

<p>\[
C_h = (R_c *h, G_c * h, B_c * h)
\]</p>

<p>å½“ h = 0çš„æ—¶å€™å°±æ˜¯é»‘è‰²ï¼Œå¦åˆ™å°±æ˜¯å…¶æœ¬èº«çš„é¢œè‰²ã€‚</p>

<p>å¯¹äºé¢œè‰²æ¸å˜ï¼Œå…¶å®ä¹Ÿå¯ä»¥åšçš„å¾ˆç®€å•ï¼Œè·Ÿä¹‹å‰ä¸€æ ·ï¼Œç”¨çº¿æ€§çš„å˜æ¢ã€‚</p>

<h2 id="toc_55">çº¿æ€§æ’å…¥ linear interpolation</h2>

<p>è€ƒè™‘è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªç‚¹Aå’ŒBï¼Œåœ¨è¿™ä¸¤ä¸ªç‚¹æœ‰æ€§è´¨ \(\alpha_A\) å’Œ \(\alpha_B\),è€ƒè™‘çº¿ä¸Šä»»æ„ä¸€ç‚¹\(\alpha_M\) ï¼š</p>

<p><img src="images/linear_interpolation.png" alt=""></p>

<p>åˆ™ </p>

<p>\[
\frac{\alpha_M - \alpha_A}{M - A} =  \frac{\alpha_B - \alpha_A}{B - A} 
\]</p>

<p>\[
\alpha_M = \frac{M - A}{B - A} \alpha_A + \frac{B-M}{B-A}\alpha_B
\]</p>

<p>è¿™ä¹Ÿå°±æ˜¯çº¿æ€§æ’å€¼ã€‚</p>

<p>è€Œæˆ‘ä»¬çš„hè®¡ç®—ä¹Ÿå°±æ˜¯åˆ©ç”¨çº¿æ€§æ’å€¼ã€‚æˆ‘ä»¬æœ‰æ¯é¡¶ç‚¹çš„åæ ‡å’Œhå€¼ï¼Œæˆ‘ä»¬å…ˆå¯ä»¥ç®—å‡ºå¯¹äºæ¯ä¸€ä¸ªyï¼Œç®—å‡ºå®ƒå¯¹åº”çš„ x<em>left, h_left å’Œ x</em>right, h_rightï¼Œç„¶ååˆ©ç”¨æ¯”ä¾‹å…³ç³»ï¼Œå¯ä»¥å¾—åˆ°ä¸‰è§’å½¢ä¸­æ¯ä¸€ä¸ªç‚¹çš„ h å€¼ã€‚</p>

<div><pre><code class="language-none">x01 = Interpolate(y0, x0, y1, x1)
h01 = Interpolate(y0, h0, y1, h1)

x12 = Interpolate(y1, x1, y2, x2)
h12 = Interpolate(y1, h1, y2, h2)

x02 = Interpolate(y0, x0, y2, x2)
h02 = Interpolate(y0, h0, y2, h2)</code></pre></div>

<p>ç„¶å h çš„å–å€¼è®¡ç®—ä¹Ÿæ˜¯è·Ÿ x ç±»ä¼¼</p>

<div><pre><code class="language-none">remove_last(x01)
x012 = x01 + x12

remove_last(h01)
h012 = h01 + h12

m = x02.length/2
if x02[m] &lt; x012[m]{
    x_left = x02
    x_right = x012
    
    h_left = h02
    h_right = h012
} else {
    x_left = x012
    x_right = x02
    
    h_left = h012
    h_right = h02
}</code></pre></div>

<p>å¯¹äºå›¾ä¸­çš„ h_segment å¯ä»¥è¿™æ ·ç®—ï¼š</p>

<div><pre><code class="language-none">h_segment = Interpolate(x_left[y-y0], h_left[y-y0], x_right[x-x0], h_right[y-y0]</code></pre></div>

<p>æ‰€ä»¥ç”»æ¸å˜ä¸‰è§’å½¢å¯ä»¥è¿™æ ·æ¥åšï¼š</p>

<div><pre><code class="language-none">DrawShadedTriangle(P0, P1, P2, color){
    # sort the points so that y0 â‰¤ y1 â‰¤ y2
    if y1 &lt; y0 { swap(p1, p0) }
    if y2 &lt; y0 { swap(p2, p0) }
    if y2 &lt; y1 { swap(p2, p1) }
    
    # compute the x coordinates of the triangle edges
    x01 = Interpolate(y0, x0, y1, x1)
    h01 = Interpolate(y0, h0, y1, h1)
    
    x12 = Interpolate(y1, x1, y2, x2)
    h12 = Interpolate(y1, h1, y2, h2)
    
    x02 = Interpolate(y0, x0, y2, x2)
    h02 = Interpolate(y0, h0, y2, h2)
    
    # concatenate the short sides
    remove_last(x01)
    x012 = x01 + x12
    
    remove_last(h01)
    h012 = h01 + h12
    
    # determine which is left and which is right
    m = x02.length/2
    if x02[m] &lt; x012[m]{
        x_left = x02
        x_right = x012
        
        h_left = h02
        h_right = h012
    } else {
        x_left = x012
        x_right = x02
        
        h_left = h012
        h_right = h02
    }
    
    
    # draw the horizontal segments
    for y = y0 to y2 {
        x_l = x_left[y - y0]
        x_r = x_right[y - y0]
        
        h_segment = Interpolate(x_left[y-y0], h_left[y-y0], x_right[x-x0], h_right[y-y0])
        for x = x_l to x_r{
            shaded_color = color * h_segment[x - xl]
            canvas.putPixel(x, y, shaded_color)
        }
    }
}
</code></pre></div>

<h2 id="toc_56">ç»“æœ</h2>

<p>çœ‹æ•ˆæœï¼š</p>

<p><img src="images/raster03.png" alt=""></p>

<p><a href="raster03.py">ä»£ç é“¾æ¥</a></p>

<h1 id="toc_57">æŠ•å½±</h1>

<p>ä¾æ—§å¦‚åŒä¹‹å‰ä¸€æ ·æ¥æ”¾ğŸ‘å’Œåæ ‡ç³»ï¼š</p>

<p><img src="images/projection.png" alt=""></p>

<p>è€ƒå¯Ÿç©ºé—´ä¸­çš„ä¸€ä¸ªç‚¹Pï¼Œçœ‹å®ƒæŠ•å½±åœ¨çª—æˆ·ä¸Šçš„åº—Pâ€˜ï¼š</p>

<p><img src="images/projection_1.png" alt=""></p>

<p>ç”±å›¾å¯ä»¥çœ‹å‡ºæ¥ï¼š</p>

<p>\[
\frac{|P&#39;A|}{|OA|} = \frac{|PB|}{|OB|}   
\]
\[
|P&#39;A| = \frac{|PB| \cdot |OA| }{|OB|}   
\]</p>

<p>æ‰€ä»¥å¯çŸ¥ï¼š</p>

<p>\[
P{_Y}&#39; = \frac{P_Y \cdot d}{P_Z}   
\]</p>

<p>åŒç†å¯çŸ¥ï¼š</p>

<p>\[
P{_X}&#39; = \frac{P_X \cdot d}{P_Z}   
\]</p>

<p>\[
P{_z}&#39; = d   
\]</p>

<h2 id="toc_58">çª—æˆ·åˆ°ç”»å¸ƒ</h2>

<p>ç„¶åçª—æˆ·åˆ°canvasçš„å˜æ¢æ˜¯ä¹‹å‰çš„ CanvasToViewport(x, y)çš„é€†å˜æ¢å§ï¼š</p>

<div><pre><code class="language-none">ViewportToCanvas{
    return (x * Cw/Vw, y * Ch/Vh)
}

ProjectVertex(v){
    return ViewportToCanvas(v.x * d / v.z, v.y * d / v.z)
}</code></pre></div>

<h2 id="toc_59">ç”»æ­£æ–¹ä½“</h2>

<div><pre><code class="language-none"># The four &#39;front&#39; vertexes
vAf = [-1, 1, 1]
vBf = [1, 1, 1]
vCf = [1, -1, 1]
vDf = [-1, -1, 1]

# The four &#39;back&#39; vertexes
vAb = [-1, 1, 2]
vBb = [1, 1, 2]
vCb = [1, -1, 2]
vDb = [-1, -1, 2]

# The front face.
DrawLine(ProjectVertex(vAf), ProjectVertex(vBf), BLUE);
DrawLine(ProjectVertex(vBf), ProjectVertex(vCf), BLUE);
DrawLine(ProjectVertex(vCf), ProjectVertex(vDf), BLUE);
DrawLine(ProjectVertex(vDf), ProjectVertex(vAf), BLUE);


# The back face.
DrawLine(ProjectVertex(vAb), ProjectVertex(vBb), RED);
DrawLine(ProjectVertex(vBb), ProjectVertex(vCb), RED);
DrawLine(ProjectVertex(vCb), ProjectVertex(vDb), RED);
DrawLine(ProjectVertex(vDb), ProjectVertex(vAb), RED);

# The front-to-back edges.
DrawLine(ProjectVertex(vAf), ProjectVertex(vAb), GREEN);
DrawLine(ProjectVertex(vBf), ProjectVertex(vBb), GREEN);
DrawLine(ProjectVertex(vCf), ProjectVertex(vCb), GREEN);
DrawLine(ProjectVertex(vDf), ProjectVertex(vDb), GREEN);</code></pre></div>

<h2 id="toc_60">ç”»å›¾</h2>

<p>è¿™é‡Œæˆ‘å·ä¸ªæ‡’ï¼Œå°±ç”¨PILçš„ç”»çº¿æ¥å¤„ç†äº†ï¼Œç¼©çŸ­ä»£ç é‡ o(â•¯â–¡â•°)o</p>

<p><img src="images/raster04.png" alt=""></p>

<p><a href="code/raster04.py">é“¾æ¥</a></p>

<h1 id="toc_61">ç”»æ­£æ–¹ä½“</h1>

<p>æˆ‘ä»¬åœ¨ç©ºé—´ä¸­æ”¾å…¥è¿™æ ·ä¸€ä¸ªæ­£æ–¹ä½“</p>

<p><img src="images/r13-cube.png" alt=""></p>

<p>å¯¹åº”çš„é¡¶ç‚¹åæ ‡æ˜¯ï¼š</p>

<ul>
<li>A = (1, 1, 1)</li>
<li>B = (-1, 1, 1)</li>
<li>C = (-1, -1, 1)</li>
<li>D = (1, -1, 1)</li>
<li>E = (1, 1, -1)</li>
<li>F = (-1, 1, -1)</li>
<li>G = (-1, -1, -1)</li>
<li>H = (1, -1, -1)</li>
</ul>

<p>é‰´äºæˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•å¤„ç†ä¸‰è§’å½¢ï¼Œæœ‰ drawWiredTriangleFrame å‡½æ•°åœ¨å‰ã€‚æˆ‘ä»¬è¿™é‡ŒæŠŠè¿™ä¸ªæ­£æ–¹ä½“çœ‹æˆæ˜¯ä¸‰è§’å½¢çš„çš„çŠ¶å†µæ¥å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªæ­£æ–¹ä½“çœ‹æˆä»¥ä¸‹ä¸€å †ä¸‰è§’å½¢</p>

<div><pre><code class="language-none">ABC ACD
EAD EHD
FEH FGH
BFG BCG
EFB EAB
CGH CDH</code></pre></div>

<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸¤ä¸ªåˆ—è¡¨æ¥è¡¨ç¤ºåæ ‡å’Œä¸‰è§’å½¢ï¼š</p>

<div><pre><code class="language-none">é¡¶ç‚¹
0 = ( 1,  1,  1)
1 = (-1,  1,  1)
2 = (-1, -1,  1)
3 = ( 1, -1,  1)
4 = ( 1,  1, -1)
5 = (-1,  1, -1)
6 = (-1, -1, -1)
7 = ( 1, -1, -1)

ä¸‰è§’å½¢
 0 = 0, 1, 2, red #å¯¹åº”çš„é¡¶ç‚¹index
 1 = 0, 2, 3, red
 2 = 4, 0, 3, green
 3 = 4, 3, 7, green
 4 = 5, 4, 7, blue
 5 = 5, 7, 6, blue
 6 = 1, 5, 6, yellow
 7 = 1, 6, 2, yellow
 8 = 4, 5, 1, purple
 9 = 4, 1, 0, purple
10 = 2, 6, 7, cyan
11 = 2, 7, 3, cyan</code></pre></div>

<p>8å„é¡¶ç‚¹ï¼Œ6ä¸ªé¢ï¼Œ12ä¸ªä¸‰è§’å½¢ã€‚âœ”ï¸</p>

<p>ä¸‰è§’å½¢çš„ä¸‰ä¸ªç‚¹æ˜¯å¯¹åº”é¡¶ç‚¹çš„indexï¼Œè¿™æ ·çš„å­˜å‚¨èƒ½å¤Ÿçœä¸‹å¾ˆå¤šç©ºé—´ã€‚</p>

<p>è¿™æ ·æ¥ç”»ç‰©ä½“å°±å¾ˆç®€å•ï¼Œ é¦–å…ˆæŠ•å½±æ¯ä¸ªé¡¶ç‚¹ï¼Œç„¶åæ ¹æ®é¡¶ç‚¹çš„æŠ•å½±æ¥ç”»ä¸‰è§’å½¢ï¼Œè®°ä½ä¸‰è§’å½¢æ˜¯projected é¡¶ç‚¹çš„é¡ºåºã€‚</p>

<div><pre><code class="language-none">RenderObject(vertexes, triangles){
    projected = []
    for V in vertexes{
        projected.append(ProjectVertex(V))
    }
    for T in triangles{
        RenderTriangle(T, projected)
    }
}

RenderTriangle(triangle, projected){
    DrawWireFrameTriangle(projected[triangle.v[0]],
    projected[triangle.v[1]],
    projected[triangle.v[2]],
    triangle.color)
}</code></pre></div>

<p>ä¸è¿‡è¿™é‡Œçš„åæ ‡æœ‰äº›ä¼šåœ¨é•œå¤´åé¢ï¼Œè¿™é‡Œæˆ‘ä»¬æ¥ç§»åŠ¨æ•´ä¸ªç‰©ä½“</p>

<p>\[
 \overrightarrow{T} = \begin{pmatrix}
  -1.5  \\
  0 \\
  7 \\ 
 \end{pmatrix}
\]</p>

<p>é‚£ä¹ˆ</p>

<p>\[
V&#39; = V + \overrightarrow{T} 
\]</p>

<h2 id="toc_62">ç”»å›¾</h2>

<p>ç”¨PILè‡ªå¸¦çš„å‡½æ•°æ¥ä¸‰è§’å½¢ o(â•¯â–¡â•°)o</p>

<p><img src="images/raster05.png" alt=""></p>

<p><a href="code/raster05.py">é“¾æ¥</a></p>

<h1 id="toc_63">ç”»ä¸¤ä¸ªæ­£æ–¹ä½“</h1>

<p>è·Ÿåˆšæ‰ä¸€æ ·ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³ç”»ä¸¤ä¸ªä½ç½®ä¸åŒçš„è¿™æ ·çš„æ­£æ–¹ä½“ï¼Œå¦‚æœæˆ‘ä»¬å°±å†å†™ä¸€é vertex å’Œ triangle çš„åˆ—è¡¨å¤ªä¸ç¬¦åˆç¼–ç¨‹çš„åŸºæœ¬åŸåˆ™äº†ã€‚</p>

<p>æ‰€ä»¥æˆ‘ä»¬è¿™æ ·åšï¼Œç”¨ model çš„è§‚ç‚¹æ¥çœ‹å¾…å®ƒï¼š</p>

<div><pre><code class="language-none">model {
    name = cube
    vertexes{
        ...
    }
    triangles{
        ...
    }
}

instance{
    model = cube
    position = (0, 0, 5)
}

instance{
    mode = cube
    position = (1, 2, 3)
}</code></pre></div>

<p>ç”»å®ƒï¼š</p>

<div><pre><code class="language-none">RenderScene(){
    for I in scene.instances{
        RenderInstance(I)
    }
}

RenderInstance(instance){
    projected = []
    model = instance.model
    for V in model.vertexes{
        V&#39; = V + instance.position
        projected.append(ProjectVertex(V&#39;))
    }
    for T in model.triangles{
        RenderTriangle(T, projected)
    }
}
</code></pre></div>

<h2 id="toc_64">ç”»å›¾</h2>

<p>ç»§ç»­å·æ‡’ï¼Œç”¨PILçš„ç”»ä¸‰è§’å½¢ o(â•¯â–¡â•°)o</p>

<p><img src="images/raster06.png" alt=""></p>

<p><a href="code/raster06.py">é“¾æ¥</a></p>

<h1 id="toc_65">ä½ç½®å˜æ¢</h1>

<h2 id="toc_66">ç§»åŠ¨ç‰©ä½“</h2>

<p>ä¹‹å‰æˆ‘ä»¬åœ¨RenderInstanceä¸­å˜æ¢äº†ç‰©ä½“çš„ä½ç½®ï¼š</p>

<div><pre><code class="language-none">RenderInstance(instance){
    projected = []
    model = instance.model
    for V in model.vertexes{
        V&#39; = V + instance.position
        projected.append(ProjectVertex(V&#39;))
    }
    for T in model.triangles{
        RenderTriangle(T, projected)
    }
}</code></pre></div>

<p>å…¶å®å¯¹äºç‰©ä½“ä½ç½®ï¼Œå¹¶éåªæœ‰ä½ç½®çš„æ”¹å˜ï¼Œæˆ‘ä»¬å¯ä»¥ scale, rotation å’Œ translation. ä½†æ˜¯éœ€è¦æ³¨æ„ä»–ä»¬çš„é¡ºåºï¼š</p>

<p><img src="images/transform.png" alt=""></p>

<p>å…ˆç¼©æ”¾ï¼Œå†æ—‹è½¬ï¼Œå†ç§»åŠ¨ã€‚</p>

<p><img src="images/transform2.png" alt=""></p>

<p>å…ˆç§»åŠ¨ï¼Œå†æ—‹è½¬ï¼Œå†ç¼©æ”¾ã€‚</p>

<p>æ‰€ä»¥ä¸€èˆ¬æ¥è¯´æ˜¯æœ€ååšç§»åŠ¨ translationã€‚å¯¹äºè¿™ä¸ªå˜æ¢çš„æè¿°å¦‚ä¸‹ï¼š</p>

<div><pre><code class="language-none">instance {
    model = cube
    transform {
        scale = 1.5
        rotation = &lt; 45Â° around the Y axis&gt;
        translation = (1, 2, 3)
    }
}</code></pre></div>

<p>è€Œè¿™ä¸ªä¹Ÿå¯ä»¥å†™æˆå‡½æ•°çš„å½¢å¼ï¼Œæ‰€ä»¥ RenderInstance() å¯ä»¥é‡å†™æˆï¼š</p>

<div><pre><code class="language-none">RenderInstance(instance){
    projected = []
    model = instance.model
    for V in model.vertexes{
        V&#39; = ApplyTransform(V, instance.transform)
        projected.append(ProjectVertex(V&#39;))
    }
    for T in model.triangles{
        RenderTriangle(T, projected)
    }
}


ApplyTransform(vertex, transform){
    V1 = vertex * transform.scale
    V2 = V1 * transform.rotation
    V3 = V2 + transform.translation
    return V3
}</code></pre></div>

<h2 id="toc_67">ç§»åŠ¨æ‘„åƒå¤´/ğŸ‘</h2>

<p>å®é™…ä¸Šç§»åŠ¨ğŸ‘å’Œç§»åŠ¨ç‰©ä½“æ˜¯ä¸å¯åˆ†è¾¨çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠğŸ‘æœå‰ç§»ï¼Œä¹Ÿå°±æ˜¯æŠŠç‰©ä½“é è¿‘ï¼Œæ—‹è½¬çœ¼ç›çš„ä½ç½®ä¹Ÿæ˜¯ç›¸å½“äºå›ºå®šğŸ‘ï¼Œæ—‹è½¬ç‰©ä½“ã€‚</p>

<div><pre><code class="language-none">V1 = V - camera.translation
V2 = V1 * inverse(camera.rotation)
V3 = perspective_projection(V2)</code></pre></div>

<h2 id="toc_68">å åŠ èµ·æ¥</h2>

<p>ç§»åŠ¨ç‰©ä½“</p>

<div><pre><code class="language-none">V1 = V * transform.scale
V2 = V1 * transform.rotation
V3 = V2 + transform.translation</code></pre></div>

<p>ç§»åŠ¨ğŸ‘</p>

<div><pre><code class="language-none">V4 = V3 - camera.translation
V5 = V4 * inverse(camera.rotation)</code></pre></div>

<p>æŠ•å½±</p>

<div><pre><code class="language-none">vx = v5.x * d / v5.z
vy = v5.y * d / v5.z</code></pre></div>

<p>çœ‹çš„çª—æˆ·åˆ°canvas</p>

<div><pre><code class="language-none">cx = vx * cw / vw
cy = vy * ch / vh</code></pre></div>

<p>å½“ç„¶å…¶å®è¿˜æœ‰ä¸€æ­¥ï¼Œ canvasç”»å¸ƒåˆ°å±å¹•ã€‚</p>

<p>ç”¨\(C_T, C_R\)è¡¨ç¤ºcameraçš„translation å’Œ rotationï¼Œ\(I_R, I_S, I_T\) è¡¨ç¤ºç‰©ä½“çš„ rotationï¼Œ scale å’Œ translationï¼Œ Pè¡¨ç¤º æŠ•å½±ï¼ŒMè¡¨ç¤º çª—æˆ·åˆ°ç”»å¸ƒã€‚ \(V\)è¡¨ç¤ºåŸå§‹åæ ‡ã€‚ \(V&#39;\)è¡¨ç¤ºç”»å¸ƒä¸Šçš„ç‚¹é‚£ä¹ˆ</p>

<p>\[
V&#39; = M(P(C_R^{-1}(C_T^{-1}(I_T(I_S(I_R(V)))))))
\]</p>

<p>åŒæ—¶æ³¨æ„æˆ‘ä»¬ä¾æ—§æŠŠå˜åŒ–æ”¾åœ¨æœ€ç»ˆä½ç½®ã€‚</p>

<p>å†™Få¦‚ä¸‹ï¼š</p>

<p>\[
F = M \cdot P \cdot C_R^{-1} \cdot C_T^{-1} \cdot I_T \cdot I_S \cdot I_R
\]</p>

<p>\[
V&#39; = F(V)
\]</p>

<h1 id="toc_69">æ•°å­¦çŸ¥è¯†</h1>

<p>æ˜¯æ—¶å€™å¤ä¹ ä¸€æ³¢æ•°å­¦çŸ¥è¯†äº†ã€‚</p>

<h2 id="toc_70">é½æ¬¡åæ ‡</h2>

<p>ç‚¹ï¼š</p>

<p>\[
\begin{pmatrix}
  x  \\
  y \\
  z \\
  1 \\ 
 \end{pmatrix}
\]</p>

<p>å‘é‡ï¼š</p>

<p>\[
\begin{pmatrix}
  x  \\
  y \\
  z \\
  0 \\ 
 \end{pmatrix}
\]</p>

<p>è¿™æ ·æ˜¯æœ‰æ„ä¹‰çš„ï¼Œæ¯”å¦‚ç‚¹ \(P - O\) æ˜¯å‘é‡ï¼Œ\(O + \overrightarrow{D}\) æ˜¯ä½ç½®ç‚¹Pï¼Œ æ‰€ä»¥å– w = 1 ä»£è¡¨ä½ç½®æ›´ä¸ºèˆ’é€‚ã€‚è€Œä¸”ä¹Ÿèµ‹äºˆäº†è¿ç®—æ›´å¤šæ„ä¹‰ã€‚</p>

<p>\[
\begin{pmatrix}
  x  \\
  y \\
  z \\
  w \\ 
 \end{pmatrix}
\]</p>

<p>å¦‚æœæ˜¯ v4 éœ€è¦å˜æˆ v3 </p>

<p>\[
\begin{pmatrix}
  x  \\
  y \\
  z \\
  w \\ 
 \end{pmatrix} 
 = 
\begin{pmatrix}
  x/w  \\
  y/w \\
  z/w \\
  1 \\ 
 \end{pmatrix}
 =
 \begin{pmatrix}
  x/w  \\
  y/w \\
  z/w \\
 \end{pmatrix}
\]</p>

<h2 id="toc_71">é½æ¬¡æ—‹è½¬çŸ©é˜µ</h2>

<p>\[
\begin{pmatrix}
 A &amp; B &amp; C \\
 D &amp; E &amp; F \\
 G &amp; H &amp; I\\
\end{pmatrix}
\cdot
\begin{pmatrix}
 x  \\
 y \\
 z \\
\end{pmatrix}
 =
\begin{pmatrix}
 x&#39;  \\
 y&#39; \\
 z&#39; \\
\end{pmatrix}
\]</p>

<p>å†™æˆé½æ¬¡æ–¹ç¨‹</p>

<p>\[
\begin{pmatrix}
 A &amp; B &amp; C &amp; 0 \\
 D &amp; E &amp; F &amp; 0\\
 G &amp; H &amp; I &amp; 0\\
 0 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix}
\cdot
\begin{pmatrix}
 x  \\
 y \\
 z \\
 1
\end{pmatrix}
 =
\begin{pmatrix}
 x&#39;  \\
 y&#39; \\
 z&#39; \\
 1
\end{pmatrix}
\]</p>

<h2 id="toc_72">é½æ¬¡scaleçŸ©é˜µ</h2>

<p>\[
\begin{pmatrix}
 S_x &amp; 0 &amp; 0 \\
 0 &amp; S_y &amp; 0 \\
 0 &amp; 0 &amp; S_z\\
\end{pmatrix}
\cdot
\begin{pmatrix}
 x  \\
 y \\
 z \\
\end{pmatrix}
 =
\begin{pmatrix}
 x \cdot S_x  \\
 y \cdot S_y \\
 z \cdot S_z \\
\end{pmatrix}
\]</p>

<p>å†™æˆé½æ¬¡æ–¹ç¨‹:</p>

<p>\[
\begin{pmatrix}
 S_x &amp; 0 &amp; 0 &amp; 0 \\
 0 &amp; S_y &amp; 0 &amp; 0 \\
 0 &amp; 0 &amp; S_z &amp; 0 \\
 0 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix}
\cdot
\begin{pmatrix}
 x  \\
 y \\
 z \\
 1 \\
\end{pmatrix}
 =
\begin{pmatrix}
 x \cdot S_x  \\
 y \cdot S_y \\
 z \cdot S_z \\
 1
\end{pmatrix}
\]</p>

<h2 id="toc_73">é½æ¬¡translationæ–¹ç¨‹</h2>

<p>å…¶å®å¦‚æœç”¨ä¸å˜æˆé½æ¬¡æ–¹ç¨‹çš„è¯ï¼Œ ç§»åŠ¨ä½ç½®ä¸æ˜¯çº¿æ€§å˜æ¢ï¼Œå°±æ›´æ— æ³•ç”¨ä¸€ä¸ªçŸ©é˜µæ¥è¡¨ç¤ºäº†ï¼Œæ„Ÿè°¢èªæ˜çš„é½æ¬¡å†™æ³•ï¼š</p>

<p>\[
\begin{pmatrix}
 T_x \\
 T_y \\
 T_z \\
 0
\end{pmatrix}
+
\begin{pmatrix}
 x  \\
 y \\
 z \\
 1 \\
\end{pmatrix}
 =
 \begin{pmatrix}
 A &amp; B &amp; C &amp; D \\
 E &amp; F &amp; G &amp; H\\
 I &amp; J &amp; K &amp; L\\
 M &amp; N &amp; O &amp; P
\end{pmatrix}
\cdot
\begin{pmatrix}
 x  \\
 y \\
 z \\
 1
 \end{pmatrix}
 =
\begin{pmatrix}
 x + T_x  \\
 y + T_y \\
 z + T_z \\
 1
\end{pmatrix}
\]</p>

<p>é€šè¿‡ä¸€ç‚¹ç‚¹æ¨ç†å¯ä»¥çŸ¥é“ï¼š</p>

<p>\[
\begin{pmatrix}
 T_x \\
 T_y \\
 T_z \\
 0
\end{pmatrix} +
\begin{pmatrix}
 x  \\
 y \\
 z \\
 1 \\
\end{pmatrix}
 =
 \begin{pmatrix}
 1 &amp; 0 &amp; 0 &amp; T_x \\
 0 &amp; 1 &amp; 0 &amp; T_y\\
 0 &amp; 0 &amp; 1 &amp; T_z\\
 0 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix}
\cdot
\begin{pmatrix}
 x  \\
 y \\
 z \\
 1
 \end{pmatrix}
 =
\begin{pmatrix}
 x + T_x  \\
 y + T_y \\
 z + T_z \\
 1
\end{pmatrix}
\]</p>

<h2 id="toc_74">æŠ•å½±çŸ©é˜µ</h2>

<p>\[
\begin{pmatrix}
 A &amp; B &amp; C &amp; D \\
 E &amp; F &amp; G &amp; H\\
 I &amp; J &amp; K &amp; L
\end{pmatrix}
\cdot
\begin{pmatrix}
 x  \\
 y \\
 z \\
 1
 \end{pmatrix}
 =
\begin{pmatrix}
 x \cdot d \\
 y \cdot d \\
 z 
\end{pmatrix}
\]</p>

<p>\[
\begin{pmatrix}
 \cfrac{x \cdot d}{z} \\
 \cfrac{y \cdot d}{z} \\
\end{pmatrix}
\]</p>

<p>æ¨ç†å¯å¾—</p>

<p>\[
\begin{pmatrix}
 d &amp; 0 &amp; 0 &amp; 0 \\
 0 &amp; d &amp; 0 &amp; 0\\
 0 &amp; 0 &amp; 1 &amp; 0
\end{pmatrix}
\cdot
\begin{pmatrix}
 x  \\
 y \\
 z \\
 1
 \end{pmatrix}
 =
\begin{pmatrix}
 x \cdot d \\
 y \cdot d \\
 z 
\end{pmatrix}
\]</p>

<h2 id="toc_75">çª—æˆ·åˆ°ç”»å¸ƒ</h2>

<p>\[
\begin{pmatrix}
 \frac{c_w}{v_w} &amp; 0 &amp; 0 &amp; 0 \\
 0 &amp; \frac{c_h}{v_h} &amp; 0 &amp; 0\\
 0 &amp; 0 &amp; 1 &amp; 0
\end{pmatrix}
\cdot
\begin{pmatrix}
 x \\
 y \\
 z \\
 1
 \end{pmatrix}
 =
\begin{pmatrix}
  \frac{c_w \cdot x}{v_w}\\
  \frac{c_h \cdot y}{v_h}\\
 z 
\end{pmatrix}
\]</p>

<p>è¿™æ ·ç”šè‡³æˆ‘ä»¬è¿˜å¯ä»¥å§ä¹‹å‰çš„æŠ•å½±çŸ©é˜µç»“åˆèµ·æ¥ï¼Œä¸€æ­¥è¾¾åˆ° 3d - ç”»å¸ƒçš„æ•ˆæœï¼š</p>

<p>\[
\begin{pmatrix}
 \frac{d \cdot c_w}{v_w} &amp; 0 &amp; 0 &amp; 0 \\
 0 &amp; \frac{c_h}{v_h} &amp; 0 &amp; 0\\
 0 &amp; 0 &amp; 1 &amp; 0
\end{pmatrix}
\cdot
\begin{pmatrix}
 x \\
 y \\
 z \\
 1
 \end{pmatrix}
 =
\begin{pmatrix}
  \frac{c_w \cdot x}{v_w}\\
  \frac{c_h \cdot y}{v_h}\\
 z 
\end{pmatrix}
\]</p>

<p>ä¸è¿‡ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬å¹¶ä¸é‡‡ç”¨çŸ©é˜µï¼Œè€Œæ˜¯ç›´æ¥è¿™æ ·ï¼š</p>

<p>\[
x&#39; = \cfrac{x \cdot d \cdot c_w}{z \cdot v_w}
\]</p>

<p>\[
y&#39; = \cfrac{y \cdot d \cdot c_h}{z \cdot v_h}
\]</p>

<p>å†æ ¹æ®ä¹‹å‰çš„</p>

<p>\[
F = M \cdot P \cdot C_R^{-1} \cdot C_T^{-1} \cdot I_T \cdot I_S \cdot I_R
\]</p>

<p>\[
V&#39; = F \cdot V
\]</p>

<p>åˆ†ç¦»ä¸€ä¸‹ï¼š</p>

<p>\[
M_{Camera} = C_R^{-1} \cdot C_T^{-1}
\]</p>

<p>\[
M_{Model} = I_T \cdot I_S \cdot I_R
\]</p>

<p>\[
M =  M_{Camera} \cdot M_{Model} 
\]</p>

<h2 id="toc_76">å†ç”»ä¸¤ä¸ªæ­£æ–¹ä½“</h2>

<p>ç„¶åæˆ‘ä»¬æ ¹æ®ä»¥ä¸Šçš„æ•°å­¦çŸ¥è¯†ï¼Œå†æ¥ç”»ä¸¤ä¸ªæ­£æ–¹ä½“ï¼Œè¿™æ¬¡æˆ‘ä»¬æ¥æŠ½è±¡æ›´å¤šçš„ä¸œè¥¿ï¼Œé¦–å…ˆæˆ‘ä»¬æœ‰åœºæ™¯(scene), åœ¨åœºæ™¯ä¸­æœ‰æ‘„åƒå¤´/çœ¼ç›(camera), ç„¶åè¿˜æœ‰ä¹‹å‰æåˆ°çš„å®ä¾‹(instance)ã€‚</p>

<p>å¯¹äºcameraï¼Œå®ƒæœ‰è‡ªå·±çš„ä½ç½®å’Œæœå‘ã€‚</p>

<p><img src="images/camera_para.png" alt=""></p>

<p>å¯¹äºinstanceï¼Œå®ƒä¹Ÿæœ‰è‡ªå·±çš„ä½ç½®ï¼Œæœå‘å’Œç¼©æ”¾ã€‚</p>

<p><img src="images/instance_para.png" alt=""></p>

<p>é‚£ä¹ˆä»£ç çš„éƒ¨åˆ†å¯ä»¥è¿™æ ·å†™ï¼š</p>

<div><pre><code class="language-none">RenderModel(model, transform) {
    projected = []
    for V in model.vertexes {
        projected.append(ProjectVertex(transform * V))
    }
    for T in model.triangles {
        RenderTriangle(T, projected)
    }
}

RenderScene() {
    MCamera = MakeCameraMatrix(camera.position, camera.orientation)

    for I in scene.instances {
        M = MCamera*I.transform
        RenderModel(I.model, M)
    }
}</code></pre></div>

<h2 id="toc_77">ç”»å›¾</h2>

<p>æ”¾ä¸¤ä¸ªæ­£æ–¹ä½“ï¼Œå˜æ¢ä¸€ä¸‹ï¼Œç„¶åç”»ä¸€ä¸‹å›¾:</p>

<p><img src="images/raster07.png" alt=""></p>

<p><a href="code/raster07.py">é“¾æ¥</a></p>

<h1 id="toc_78">è£å‰ª</h1>

<p>å›æ¥çœ‹è¿™ä¸ªæŠ•å½±å…¬å¼ï¼š</p>

<p>\[
P_x&#39; = \cfrac{P_x \cdot d}{ P_Z}
\]</p>

<p>\[
P_y&#39; = \cfrac{P_y \cdot d}{ P_Z}
\]</p>

<p>ä½†æ˜¯å¯èƒ½å‡ºç°çš„é—®é¢˜æ˜¯ï¼š</p>

<ul>
<li>é™¤ä»¥0</li>
<li>å¯¹äºå¾ˆå°çš„Pzï¼Œå¯èƒ½å¤±çœŸ</li>
</ul>

<p>æ‰€ä»¥æˆ‘ä»¬åº”è¯¥å­¦ä¹ æ¯”å¦‚åƒ z = d ä¸€æ ·ç”¨ä¸€ä¸ªå¹³é¢æ¥è£å‰ªç‰©ä½“.</p>

<h2 id="toc_79">å¹³é¢</h2>

<p>æˆ‘ä»¬çŸ¥é“ä¸‰ç»´ä¸–ç•Œä¸­çš„ä¸€ä¸ªå¹³é¢å¯ä»¥è¿™æ ·æ¥ï¼š</p>

<p>\[
Ax + By + Cz + D = 0
\]</p>

<p>å®é™…å¯ä»¥å†™æˆ</p>

<p>\[
\overrightarrow{N} \cdot P + D = 0
\]</p>

<p>\[ \overrightarrow{N} = \begin{bmatrix} A \\ B \\C \end{bmatrix} \]</p>

<p>å¯ä»¥ç»§ç»­å†™ï¼š</p>

<p>\[
k \cdot \overrightarrow{N} \cdot P + k \cdot D = 0
\]</p>

<p>ç»§ç»­ï¼š</p>

<p>\[
\overrightarrow{N&#39;} \cdot P + D&#39; = 0
\]</p>

<p>å–\(\overrightarrow{N&#39;} = \overrightarrow{N}\)ä¸ºå•ä½å‘é‡ï¼Œç»§ç»­å†™å›ï¼š</p>

<p>\[
\overrightarrow{N} \cdot P + D = 0
\]</p>

<p>å…³äºè¿™ä¸ªå…¬å¼ï¼Œå¯ä»¥æœ‰å¾ˆå¤šç†è§£ï¼Œæ¯”å¦‚å…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£å¹³é¢:</p>

<p>æ³•å‘é‡ä¸º\(\overrightarrow{N}\)ï¼Œå¹³é¢ä¸Šæœ‰ç‚¹\(P&#39;\).</p>

<p><img src="images/plane_01.png" alt=""></p>

<p>æ‰€ä»¥ä¼šæœ‰å¹³é¢ä¸Šçš„æ‰€æœ‰ç‚¹\(P\)æ»¡è¶³çš„: </p>

<p>\[
\overrightarrow{N} \cdot (P - P&#39;) = 0
\]</p>

<p>è€Œå¦‚æœæˆ‘ä»¬è¦è®¡ç®—ä»»æ„ä¸€ç‚¹ \(Q\) åˆ°å¹³é¢çš„ä½ç½®å¯ä»¥è¿™æ ·æ¥ï¼Œ è®¡ç®— \(|Q - Q&#39;|\), \(Q&#39;\) ä¸ºQåœ¨å¹³é¢ä¸Šçš„æŠ•å½±ï¼Œæˆ‘ä»¬å¯çŸ¥ï¼š</p>

<p>\[
Q - Q&#39; = t \cdot \overrightarrow{N}
 \]</p>

<p><img src="images/plane_02.png" alt=""></p>

<p>ä¸¤è¾¹åŒæ—¶ä¹˜ä»¥ \(\overrightarrow{N}\):</p>

<p>\[
\overrightarrow{N}(Q - Q&#39;) = t \cdot \overrightarrow{N} \cdot \overrightarrow{N} = t 
\]</p>

<p>\(Q&#39;\) åœ¨å¹³é¢ä¸Šï¼Œ ä»£å…¥å¹³é¢å…¬å¼</p>

<p>\[
\overrightarrow{N} \cdot Q&#39; + D = 0
\]</p>

<p>æ‰€ä»¥</p>

<p>\[
\overrightarrow{N} \cdot Q + D = t 
\]</p>

<p>å®é™…ä¸Š\(\overrightarrow{N} \cdot Q + D\) å°±æ˜¯ Q åˆ°å¹³é¢çš„ &#39;signed distance&#39;ï¼Œä¸º0 å°±æ˜¯Påœ¨å¹³é¢ä¸Šçš„ç‰¹æ®ŠçŠ¶å†µã€‚</p>

<p>å¯¹äº \( Z = d\) æˆ‘ä»¬å°±æ˜¯å¯ä»¥é€‰æ‹© \(\overrightarrow{N} = (0, 0, 1)\)ï¼Œ å¯¹åº” \(D = -d\).</p>

<h2 id="toc_80">Clipping volume</h2>

<p>æ ¹æ®æˆ‘ä»¬çš„æ•°æ®</p>

<p><img src="images/clipping_1.png" alt=""></p>

<p>å¦‚æœæˆ‘ä»¬çš„ foc éƒ½é€‰ 90Â°çš„ï¼Œé‚£ä¹ˆå¦‚ä¸‹ï¼š</p>

<p><img src="images/clipping_2.png" alt=""></p>

<ul>
<li>left plane çš„ \(\overrightarrow{N}\) æ˜¯ \( (\cfrac{1}{\sqrt2}, 0, \cfrac{1}{\sqrt2})\)</li>
<li>right plane çš„ \(\overrightarrow{N}\) æ˜¯ \( (-\cfrac{1}{\sqrt2}, 0, \cfrac{1}{\sqrt2})\)</li>
<li>bottom plane çš„ \(\overrightarrow{N}\) æ˜¯ \( ( 0, \cfrac{1}{\sqrt2}, \cfrac{1}{\sqrt2})\)</li>
<li>top plane çš„ \(\overrightarrow{N}\) æ˜¯ \( ( 0, -\cfrac{1}{\sqrt2}, \cfrac{1}{\sqrt2})\)</li>
</ul>

<p>æ‰€æœ‰çš„ \( D = 0\) å› ä¸ºéƒ½é€šè¿‡åŸç‚¹ã€‚</p>

<h2 id="toc_81">è£å‰ªæ•´ä¸ªç‰©ä½“</h2>

<p>æˆ‘ä»¬å…ˆæ¥å°è¯•è£å‰ªæ•´ä¸ªç‰©ä½“ï¼Œå¦‚æœæˆ‘ä»¬åˆšå¥½æœ‰ä¸€ä¸ªçƒå¯ä»¥åŒ…ä½ç‰©ä½“ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®¡ç®—çƒåˆ°å¹³é¢çš„ä½ç½®ï¼Œå¦‚æœæ•´ä¸ªçƒåˆšå¥½åœ¨å¹³é¢ä¹‹å†…ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç»˜åˆ¶æ•´ä¸ªç‰©ä½“ï¼Œå¦‚æœçƒåœ¨æ•´ä¸ªå¹³é¢ä¹‹å¤–ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸éœ€è¦ç»˜åˆ¶ç‰©ä½“ã€‚ä½†æ˜¯å¯¹äºå’Œå¹³é¢ç›¸äº¤çš„çƒï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›ä¸€æ­¥çš„è®¡ç®—ã€‚</p>

<p><img src="images/clip_obj_01.png" alt=""></p>

<p>è®¡ç®—çš„æ—¶å€™å°±å¯ä»¥ç”¨æˆ‘ä»¬åˆšåˆšæåˆ°çš„ signed distance.</p>

<p><img src="images/clip_obj_02.png" alt=""></p>

<h2 id="toc_82">è£å‰ªä¸‰è§’å½¢</h2>

<p>å¯¹äºç›¸äº¤çš„çŠ¶å†µï¼Œæˆ‘ä»¬éœ€è¦è£å‰ªä¸‰è§’å½¢ï¼Œå¯¹åº”çš„ä¹Ÿæœ‰ä»¥ä¸‹æƒ…å†µï¼š</p>

<ul>
<li>ä¸‰é¡¶ç‚¹å…¨åœ¨å¹³é¢å†…</li>
<li>ä¸‰é¡¶ç‚¹å…¨åœ¨å¹³é¢å¤–</li>
<li>ä¸€é¡¶ç‚¹åœ¨å¹³é¢å†…</li>
<li>ä¸¤é¡¶ç‚¹åœ¨å¹³é¢å†…</li>
</ul>

<p>å¯¹äºä¸€é¡¶ç‚¹åœ¨å¹³é¢å†…ï¼Œæˆ‘ä»¬éœ€è¦ä¸¢æ‰\(ABC\), ç”»ä¸‰è§’å½¢\(AB&#39;C&#39;\).</p>

<p><img src="images/clip_triangle_01.png" alt=""></p>

<p>å¯¹äºä¸¤é¡¶ç‚¹åœ¨å¹³é¢å†…ï¼Œæˆ‘ä»¬éœ€è¦ä¸¢æ‰\(ABC\)ï¼Œ ç”»\(ABA&#39;\) å’Œ \(A&#39;B&#39;B\).</p>

<p><img src="images/clip_triangle_02.png" alt=""></p>

<h2 id="toc_83">è®¡ç®—çº¿ä¸é¢çš„äº¤ç‚¹ B&#39;</h2>

<p>\(B&#39;\) åˆ™æ˜¯ ç›´çº¿ AB ä¸å¹³é¢çš„äº¤ç‚¹ã€‚</p>

<p>å¹³é¢å…¬å¼ï¼š</p>

<p>\[
\overrightarrow{N} \cdot P + D = 0
\]</p>

<p>ç›´çº¿å¯ä»¥å†™æˆï¼š </p>

<p>\[
P = A + t(B - A), 0 \le t \le 1
\]</p>

<p>ä»£å…¥ï¼š</p>

<p>\[
\overrightarrow{N} \cdot (A + t(B - A)) + D = 0
\]</p>

<p>\[
t = \frac{-D - \overrightarrow{N} \cdot A}{ \overrightarrow{N} \cdot (B - A)}
\]</p>

<p>å› ä¸ºæˆ‘ä»¬å·²ç»å‡å®šç›´çº¿å’Œå¹³é¢ç›¸äº¤ï¼Œæ‰€ä»¥ t æ€»æ˜¯æœ‰è§£ï¼Œå½“æˆ‘ä»¬è®¡ç®—å‡ºæ¥ t ä¹‹åï¼Œå†ä»£å›åŸå…¬å¼å¾—åˆ°äº¤ç‚¹Qï¼š</p>

<p>\[
Q = A + t(B - A)
\]</p>

<p>ç”šè‡³æˆ‘ä»¬å¯ä»¥æ ¹æ® Q æ¥è®¡ç®—ä¸ Q ç›¸å…³çš„ä¸€äº›å±æ€§ï¼š</p>

<p>\[
\alpha_Q = \alpha_A + t(\alpha_B - \alpha_A)
\]</p>

<h2 id="toc_84">ç”»å›¾</h2>

<p>æ³¨æ„æˆ‘ä»¬æ•´ä¸ªæµç¨‹å¯ä»¥è¿™æ ·ç”»å‡ºæ¥ï¼š</p>

<p><img src="images/clip.png" alt=""></p>

<p>æ³¨æ„ä»£ç æœ‰æ¯”è¾ƒå¤§çš„æ”¹åŠ¨ã€‚</p>

<p>ç»“æœ</p>

<p><img src="images/raster08.png" alt=""></p>

<p><a href="code/raster08.py">ä»£ç </a></p>

<h1 id="toc_85">éšè—é¢æ¶ˆé™¤</h1>

<p>æˆ‘ä»¬å…ˆåˆ©ç”¨ç°æœ‰çš„ä»£ç æ¥å¡«å……ç”»æ­£æ–¹ä½“çš„ä¸‰è§’å½¢ï¼Œè€Œä¸æ˜¯æ¡†æ¶ï¼š</p>

<p><img src="images/cube_filled_01.png" alt=""></p>

<p>ä¸å¤ªå¥½çœ‹ï¼Œé‚£æ˜¯å› ä¸ºæˆ‘ä»¬æŠŠæœ‰äº›èƒŒé¢çš„ä¸œè¥¿ç”»åˆ°äº†å‰é¢ï¼Œæ¯”å¦‚ä¸‹é¢çš„æ­£æ–¹ä½“çš„åº•éƒ¨ã€‚æˆ‘ä»¬ç”»ä¸‰è§’å½¢çš„æ—¶å€™å¹¶æ²¡æœ‰å…ˆåé¡ºåºï¼Œè€Œæ˜¯æ ¹æ®ä»–ä»¬çš„å®šä¹‰çš„é¡ºåºæ¥ç”»çš„ã€‚</p>

<p>è¿™é‡Œæˆ‘ä»¬å°±è¦è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>

<h2 id="toc_86">Painterâ€™s algorthim</h2>

<p>æœ€å®¹æ˜“æƒ³åˆ°çš„åŠæ³•å°±æ˜¯å…ˆç”»åæ–¹çš„ä¸œè¥¿ï¼Œç„¶åå†ç”»å‰é¢çš„ä¸œè¥¿ï¼Œè¿™ä¸ªå®ç°çš„è¯ - å¯ä»¥é¦–å…ˆæŠŠä¸‰è§’å½¢transformä¹‹åï¼Œç„¶åæ ¹æ®ä»–ä»¬çš„zåæ ‡æ’åºï¼Œå…ˆç”»åé¢å†ç”»å‰é¢ã€‚</p>

<p>è¿™ä¸ªæ–¹æ³•çš„é—®é¢˜åœ¨äºï¼š</p>

<ul>
<li>æœ€å¿«çš„æ’åºæ–¹å¼ä¹Ÿæ˜¯\(O(nlogn)\)</li>
<li>æˆ‘ä»¬éœ€è¦ä¸€æ¬¡å°±æŠŠæ‰€æœ‰çš„vertexå’Œtriangleæ”¾å…¥å†…å­˜ä¸­</li>
<li>æœ‰äº›æƒ…å†µæ ¹æœ¬æ²¡æœ‰é¡ºåº</li>
</ul>

<p><img src="images/impossible_sort.png" alt=""></p>

<h2 id="toc_87">Depth buffer</h2>

<p>è™½ç„¶Painterâ€˜s Algorithmå¯¹ä¸‰è§’å½¢ä¸èµ·ä½œç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å¤„ç†åƒç´ ã€‚</p>

<p>å¯¹äºæ¯ä¸ªç”»åˆ°ç”»å¸ƒä¸Šçš„åƒç´ ï¼Œæˆ‘ä»¬åªéœ€è¦ç”»ä¸å®ƒæœ€è¿‘çš„é¢œè‰²ã€‚æ¯”å¦‚\(P_1\) å’Œ \(P_2\) éƒ½æŠ•å½±åˆ°äº† z=dä¸Šçš„Pç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦ç”»è¿‘çš„é‚£ä¸ªç‚¹çš„é¢œè‰²ã€‚</p>

<p><img src="images/depth.png" alt=""></p>

<p>æ‰€ä»¥å¯¹äºåƒç´ ä¸Šçš„æ¯ä¸ªç‚¹ï¼Œæˆ‘ä»¬éœ€è¦è®°å½•ä¸‹å®ƒçš„zå€¼ï¼Œå½“æˆ‘ä»¬ç¢°åˆ°åŒæ ·è¿™ä¸ªç‚¹ï¼Œä½†æ˜¯æœ‰æ›´å°çš„zå€¼çš„æ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ›´æ–°é¢œè‰²ï¼Œå¦åˆ™æˆ‘ä»¬ä¿æŒåŸæœ‰é¢œè‰²ä¸å˜ï¼Œå½“ç„¶æœ€åˆæˆ‘ä»¬å¯ä»¥æŠŠåŸå§‹çš„æ¯ä¸ªåƒç´ çš„zå€¼éƒ½èµ‹å€¼ç»™æ— ç©·å¤§ã€‚</p>

<p>è¿™ä¸ªzå€¼å½“ç„¶æ˜¯ç‰©ä½“åœ¨transformä¹‹åä½†æ˜¯é€è§†æŠ•å½±ä¹‹å‰çš„zï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬åªæœ‰æ¯ä¸ªä¸‰è§’å½¢é¡¶ç‚¹çš„zå€¼ï¼Œæˆ‘ä»¬ç”»å¡«å……çš„æ—¶å€™éœ€è¦çŸ¥é“ä¸‰è§’å½¢ä¸­æ¯ä¸ªç‚¹çš„zå€¼ï¼Œè¿™é‡Œå…ˆå†çœ‹ä¸€æ¬¡ä¸Šé¢çš„å›¾ï¼Œyæ˜¯éšç€zçš„å˜åŒ–è€Œæˆæ¯”ä¾‹å˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠzçœ‹æˆyæˆ–è€…xçš„æ€§è´¨ï¼Œåˆ«å¿˜äº†æˆ‘ä»¬ç”»æ¸å˜ä¸‰è§’å½¢çš„æ—¶å€™æ˜¯æ€ä¹ˆæŠŠhçœ‹æˆä¸‰è§’å½¢ä¸­æ¯ä¸ªç‚¹çš„æ€§è´¨è€Œç”»å‡ºæ¥çš„ã€‚</p>

<p>ä¼ªç ï¼š</p>

<div><pre><code class="language-none">z = z_segment[x - xl]
if (z &lt; depth_buffer[x][y]){
    canvas.PutPixel(x, y, color)
    depth_buffer[x][y] = z
}</code></pre></div>

<p>çœ‹ç»“æœï¼Œæ•ˆæœè¿˜ä¸é”™ï¼Œè‡³äºè¾¹ç¼˜çš„çŠ¶å†µï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¸ºäº† loop interpolation,æŠŠ x, y éƒ½å˜æˆäº† intï¼Œå…¶é—´éš¾å…ä¼šæœ‰ä¸€äº›æŸå¤±çš„çŠ¶å†µã€‚</p>

<p><img src="images/raster10.png" alt=""></p>

<h2 id="toc_88">1/z</h2>

<p>æˆ‘ä»¬æŠŠ z çœ‹æˆ x çš„æ€§è´¨ç„¶åçº¿æ€§æ’å…¥æ±‚å‡ºå®ƒã€‚è¿™é‡Œæœ‰ä¸€ç‚¹ç‚¹é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p>

<p><img src="images/linear_interpolation_02.png" alt=""></p>

<p>è¿™é‡Œå¯ä»¥å¾ˆå®¹æ˜“ç®—å‡ºæ¥ M (0, 0, 6).</p>

<p>ä½†å®é™…ä¸Šï¼š</p>

<p><img src="images/linear_interpolation_03.png" alt=""></p>

<p>è®¡ç®—å¦‚ä¸‹ï¼š</p>

<p>\[
\frac{M_z - A_z}{M_x&#39; - A_x&#39;} = \frac{B_z - A_z}{B_x&#39; - A_x&#39;}
\]</p>

<p>ä»£å…¥æ•°å€¼ï¼š</p>

<p>\[
M_z = 2 + (0 - (-0.5))\frac{10 - 2}{0.1 - (-0.5)} = 8.666
\]</p>

<p>\(M_z \neq 6\)</p>

<p>é—®é¢˜å‡ºåœ¨æˆ‘ä»¬å‡è®¾ z æ˜¯ æ˜¯å®ƒä»¬çš„çº¿æ€§ç»„åˆï¼Œå³ \(Z = f(x&#39;, y&#39;)\)ï¼Œé‚£ä¹ˆ \(Z = Ax&#39; + By&#39;+ C\).å¯¹åº”è¿™æ ·çš„çŠ¶å†µï¼š</p>

<p>\[
f(x&#39; + \Delta x, y&#39; + \Delta y) - f(x&#39;, y&#39;) = A(x&#39; + \Delta x) + B(y&#39; + \Delta y) + C - Ax&#39; - By&#39; - C = A \Delta x + B \Delta y
\]</p>

<p>é—®é¢˜åœ¨äºè¿™é‡Œæˆ‘ä»¬çš„ä¸‰è§’å½¢æ»¡è¶³å…¬å¼ï¼š</p>

<p>\[
AX + BY + CZ + D = 0
\]</p>

<p>æ ¹æ® æŠ•å½±å…¬å¼ï¼š</p>

<p>\[
x&#39; = \frac{Xd}{Z}
\]</p>

<p>\[
y&#39; = \frac{Yd}{Z}
\]</p>

<p>æ‰€ä»¥</p>

<p>\[
X = \frac{Zx&#39;}{d}
\]
\[
Y = \frac{Zy&#39;}{d}
\]</p>

<p>ä»£å›åŸå¼ï¼š</p>

<p>\[
\frac{Ax&#39;Z + By&#39;Z}{d} + CZ + D = 0
\]</p>

<p>\[
Ax&#39;Z + By&#39;Z + dCZ + dD = 0
\]</p>

<p>\[
(Ax&#39; + By&#39; + dC)Z + dD = 0
\]</p>

<p>\[
Z = \frac{-dD}{Ax&#39; + By&#39; + C}
\]</p>

<p>æ‰€ä»¥Zå¹¶ä¸æ˜¯ x&#39; å’Œ yâ€˜ çš„è±¡å½¢ç»„åˆï¼Œä½†æ˜¯ 1/Z åˆ™æ˜¯ï¼š</p>

<p>\[
1/Z = \frac{Ax&#39; + By&#39; + C}{-dD}
\]</p>

<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ 1/Z è€Œé Z æ¥è®¡ç®—ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠæ‰€æœ‰çš„depth_buffer åˆå§‹åŒ–ä¸º0ï¼Œå¹¶ä¸”æ¯”è¾ƒéœ€è¦åå‘ã€‚</p>

<p>æ•ˆæœï¼š</p>

<p><img src="images/raster11.png" alt=""></p>

<p>è¿™ä¸ªå¯¹æˆ‘çš„å¹¶æ²¡æœ‰å¤ªå¤§æå‡ï¼ŒåŸå› ä¹‹å‰å·²ç»è®²è¿‡äº†ã€‚o(â•¯â–¡â•°)o.</p>

<h2 id="toc_89">æ¶ˆé™¤èƒŒé¢</h2>

<p>å®é™…ä¸Šè¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯åšäº†å¾ˆå¤šâ€˜æ— ç”¨åŠŸâ€™ï¼Œæ¯”å¦‚æŠŠåæ–¹è¢«é®ç›–çš„ä¸‰è§’å½¢ç”»äº†ä¸€éã€‚æˆ‘ä»¬è¿˜å¯ä»¥æ•ˆç‡æ›´é«˜ï¼šæ ¹æ®ğŸ‘å¯ä»¥çœ‹åˆ°æˆ–è€…çœ‹ä¸åˆ°æ¥ä¸¢å¼ƒä¸‰è§’å½¢ã€‚</p>

<p><img src="images/triangle_normal_01.png" alt=""></p>

<p>å¯¹äºçœ‹ä¸åˆ°çš„ä¸‰è§’å½¢ï¼Œæˆ‘ä»¬ç”»çš„æ—¶å€™å¯ä»¥ç›´æ¥ä¸¢å¼ƒã€‚</p>

<p>è¿™ä¸ªè§’åº¦ä¹Ÿå¾ˆå®¹æ˜“æ±‚å‡ºæ¥, æŒ‡å‘å¤–çš„ç®­å¤´æ˜¯ä¸‰è§’å½¢çš„æ³•å‘é‡ \(\overrightarrow{N}\), \(\overrightarrow{V}\) æ˜¯ç”±ä¸‰è§’å½¢ä¸Šçš„ç‚¹Påˆ°çœ¼ç›çš„å‘é‡ã€‚</p>

<p>é‚£ä¹ˆ</p>

<p>\[
cos \alpha = \frac{\overrightarrow{N} \cdot \overrightarrow{V}}{|\overrightarrow{N}| \cdot |\overrightarrow{V}|}
\]</p>

<p>å› ä¸ºæˆ‘ä»¬åªç”¨å…³å¿ƒ \(\alpha\) æ˜¯å¤§äº 90Â°è¿˜æ˜¯å°äº90Â°ï¼Œæˆ‘ä»¬åªéœ€è®¡ç®— \(\overrightarrow{N} \cdot \overrightarrow{V}\).</p>

<ul>
<li>\(\overrightarrow{N} \cdot \overrightarrow{V} &lt;= 0\) èƒŒé¢</li>
<li>\(\overrightarrow{N} \cdot \overrightarrow{V} &gt; 0\) å‰é¢</li>
</ul>

<p>è€Œå¯¹äºä¸‰è§’å½¢æŒ‡å‘å¤–éƒ¨çš„æ³•å‘é‡çš„æ–¹å‘ \(\overrightarrow{N}\)ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå¥½æ±‚ï¼Œ æˆ‘ä»¬ç”¨ \(\overrightarrow{AB} \times \overrightarrow{AC}\) .å‰ä¹˜å°±èƒ½è®¡ç®—å‡ºæ¥ã€‚</p>

<p>è‡³äº\(\overrightarrow{V}\)ï¼Œæˆ‘ä»¬ç”¨ä¸‰è§’å½¢å†…ä»»æ„ä¸€ç‚¹\(P - O\)æ—¢å¯ï¼Œæœ€ç®€å•çš„Pçš„é€‰æ‹©å¯ä»¥æ˜¯ \((A + B + C)/3\).è¿™é‡Œä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œ å¯¹äºä¸‰è§’å½¢ BC è¾¹ä¸Šçš„ä»»æ„ä¸€ç‚¹ D å¯ä»¥æ˜¯</p>

<p>\[D = B + v(C - B), 0 \le v \le 1\] </p>

<p>\[P = A + u(D - A), 0 \le u \le 1\]</p>

<p><img src="images/inside_triangle.png" alt=""></p>

<p>\[P = A + u( B + v(C - B) - A), 0 \le u \le 1\]</p>

<p>æœ€ç»ˆæŠŠä¸‰è§’å½¢å†…éƒ¨å’Œè¾¹ä¸Šçš„ä»»æ„ä¸€ç‚¹Péƒ½å¯ä»¥å†™æˆï¼š</p>

<p>\[
P = p_1A + p_2B + p_3C
\]</p>

<p>\[
p_1 + p_2 + p_3 = 1
\]</p>

<p>\[
0 \le p_1 \le 1, 0 \le p_2 \le 1, 0 \le p_3 \le 1
\]</p>

<p>å…¶å®å– 1/3 æ˜¯è¿™ä¸ªä¸‰è§’å½¢çš„ä¸­å¿ƒã€‚</p>

<p>æ‰€ä»¥æˆ‘ä»¬åœ¨ä»£ç ä¸­æ·»åŠ ï¼šçœ‹ä¸åˆ°çš„ä¸‰è§’å½¢æˆ‘ä»¬æå‰ä¸¢å¼ƒï¼Œç„¶åå†æ¥ç”»ã€‚</p>

<p>æ•ˆæœï¼š</p>

<p><img src="images/raster12.png" alt=""></p>

<p><a href="code/raster12.py">ä»£ç </a># ç€è‰² Shading </p>

<p>Shading å¹¶ä¸æ˜¯ç…§æ˜ï¼Œç…§æ˜æˆ‘ä»¬ä¹‹å‰å·²ç»è®²è¿‡<a href="https://zhuanlan.zhihu.com/p/63343562">æ¨¡å‹</a>ï¼Œæœ‰ç‚¹å…‰æºï¼Œæ–¹å‘å…‰ï¼Œç¯å¢ƒå…‰ï¼Œå¹¶ä¸”æˆ‘ä»¬å·²ç»çŸ¥é“å®ƒæ˜¯å¦‚ä½•ä¸ä¸€ä¸ªç‚¹äº’åŠ¨ã€‚</p>

<p>è¿™é‡Œæˆ‘ä»¬è¦è®²çš„æ˜¯ç€è‰²ã€‚</p>

<h2 id="toc_90">å¹³é¢ç€è‰² Flat Shading</h2>

<p>æˆ‘ä»¬å¯ä»¥æ ¹æ®å…¬å¼ç®—å‡ºä»»æ„ä¸€ç‚¹çš„å…‰ç…§ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç‰©ä½“æ¨¡å‹éƒ½æ˜¯ä¸‰è§’å½¢ï¼Œæˆ‘ä»¬éšæ„é€‰å–ä¸‰è§’å½¢ä¸­çš„ä¸€ç‚¹ï¼ˆä¸­å¿ƒï¼‰ï¼Œè®¡ç®—é‡ç‚¹çš„é¢œè‰²ï¼Œç„¶åç”¨è¿™ä¸€ç‚¹æ¥ç€è‰²æ•´ä¸ªä¸‰è§’å½¢ï¼ˆåŒæ ·ç”¨å…‰ç…§ä¹˜ä»¥é¢œè‰²ï¼‰ã€‚</p>

<p>æˆ‘ä»¬æ¥ç€è‰²ä¸¤ä¸ªæ­£æ–¹ä½“:</p>

<p><img src="images/raster13_r1.png" alt=""></p>

<p>not bad, ä½†å…¶å®æˆ‘ä»¬è¿˜æ˜¯èƒ½å¤Ÿçœ‹æ¸…æ¯”å¦‚æ­£å¯¹ç€æˆ‘ä»¬è¿™ä¸ªç»¿è‰²çš„é¢æœ‰è¿™ä¸ªæ­£æ–¹å½¢èƒ½çœ‹å‡ºä¸¤ä¸ªä¸‰è§’å½¢çš„åˆ†ç•Œçº¿ï¼Œå¾ˆæ­£å¸¸ï¼ŒæŒ‰ç…§æˆ‘ä»¬çš„ç®—æ³•ï¼Œçš„ç¡®å¯ä»¥çœ‹å‡ºæ¥ã€‚</p>

<p>ä¸ºäº†å¢åŠ ä¸€äº›ä¹è¶£æ€§ï¼Œæˆ‘ç°åœ¨åœ¨åœºæ™¯ä¸­æ·»åŠ ä¸€ä¸ªçƒä½“ï¼Œè€Œä¸”è¿™ä¸ªçƒä½“éœ€è¦æ»¡è¶³æˆ‘ä»¬çš„æ¨¡å‹è¿™ä¸ªç±»ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ä¸‰è§’å½¢æ¥æ¨¡ä»¿å®ƒã€‚</p>

<h2 id="toc_91">ç”¨ä¸‰è§’å½¢æ¥æ¨¡ä»¿çƒä½“</h2>

<h3 id="toc_92">å…ˆä»ç‚¹çœ‹èµ·</h3>

<p>å…ˆä»åˆ†ç¦»çš„ç‚¹çœ‹èµ·ï¼Œå¬èµ·æ¥å¥½åƒä¸æ˜¯å¾ˆéš¾ã€‚</p>

<p><img src="images/sphere_01.png" alt=""></p>

<p>æœ‰åœ¨Oç‚¹çš„åŠå¾„ä¸º r çš„çƒä½“ï¼Œè€ƒé‡çƒä½“ä¸Šä»»æ„ä¸€ç‚¹ Bã€‚</p>

<p><img src="images/sphere_02.png" alt=""></p>

<p>æœ‰</p>

<p>\[
|OB&#39;|^2 + |BB&#39;|^2 = r^2
\]</p>

<p>å¦‚æœæˆ‘ä»¬æŠŠ y åˆ†æˆ n ä»½ï¼Œé‚£ä¹ˆä»ä¸‹å¾€ä¸Š</p>

<p><img src="images/sphere_03.png" alt=""></p>

<p>\[
y_B = \frac{2 * r * d}{n} - r 
\]</p>

<p>\[
0 \le d \le n
\]</p>

<p>æ­¤æ—¶æˆ‘ä»¬æœ‰äº† \(|BB&#39;|\)ï¼Œ åŒæ ·å¯ä»¥å¾—åˆ° \(|OB&#39;| = \sqrt{r^2 - y_B^2}\).</p>

<p>æœ‰äº† \(OB&#39;\), æˆ‘ä»¬æ­¤æ—¶æ¥ç ”ç©¶åœ¨ OB&#39;</p>

<p><img src="images/sphere_04.png" alt=""></p>

<p>å¦‚æœæˆ‘ä»¬åŒæ ·æŠŠ xz å¹³é¢çš„è¿™ä¸ª 2 * Ï€ æ¥ç™»åˆ†æˆ n ä»½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥çŸ¥é“ </p>

<p>\[
\alpha = \frac{2 \cdot Ï€ \cdot i}{n}
\]</p>

<p>\[
0 \le i &lt; n 
\]</p>

<p>å› ä¸º 2 * Ï€ ä¸ 0 é‡åˆã€‚</p>

<p>è¿™æ ·ç»™æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ° B&#39; ç‚¹çš„åæ ‡:</p>

<p>\[
x_B = |OB&#39;| \cdot cos \alpha 
\]</p>

<p>\[
z_B = |OB&#39;| \cdot sin \alpha
\]</p>

<p>ç»“åˆèµ·æ¥æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ° B ç‚¹çš„åæ ‡ï¼Œè¿™å°±æ˜¯æ€è·¯ï¼š</p>

<ul>
<li>yå¹³åˆ†æˆnæ®µï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—åˆ°äº† n+1 ä¸ªçƒçš„æˆªé¢ - åœ†</li>
<li>é’ˆå¯¹æ¯ä¸€ä¸ªyï¼Œæˆ‘ä»¬å†æ¨¡æ‹Ÿåœ†ï¼Œå¾—åˆ°ç‚¹</li>
</ul>

<p>æœ‰äº†è¿™ä¸ªæ€è·¯ï¼Œå¯ä»¥å†™å‡ºç®€å•çš„ä»£ç ï¼š</p>

<div><pre><code class="language-none">r = 1
n = 10

from cmath import pi
from math import sqrt, cos, sin


for d in range(n + 1):
    yb = 2 * r * d / n - r
    for i in range(n):
        alpha = 2 * pi * i / n
        rprime = sqrt(r * r - yb * yb)
        xb = rprime * cos(alpha)
        zb = rprime * sin(alpha)
        print (xb,&#39;\t&#39;,yb,&#39;\t&#39;,zb)</code></pre></div>

<p>å‘ç°é’ˆå¯¹ r = 1, n = 10 å·²ç»èƒ½å¤Ÿå¾—åˆ°å¾ˆå¥½çœ‹çš„æ•ˆæœã€‚</p>

<p>ç°åœ¨æ¥çœ‹å‡ ä¸ªï¼š</p>

<ul>
<li>r = 5, n = 5</li>
</ul>

<p><img src="images/sphere_r5n5.png" alt=""></p>

<p>åŸºæœ¬çœ‹ä¸å‡ºæ¥çƒ o(â•¯â–¡â•°)o</p>

<ul>
<li>r = 5, n = 15</li>
</ul>

<p><img src="images/sphere_r5n15.png" alt=""></p>

<ul>
<li>r = 5, n = 25</li>
</ul>

<p><img src="images/sphere_r5n25.png" alt=""></p>

<p>å¥½çœ‹å¤šäº†ã€‚</p>

<h3 id="toc_93">åˆ†é…ä¸‰è§’å½¢</h3>

<p>æœ‰äº†ç‚¹ä¹‹åï¼Œæˆ‘ä»¬è¦æŠŠè¿™äº›ç‚¹åˆ†é…æˆä¸‰è§’å½¢ã€‚é¦–å…ˆæˆ‘ä»¬è‚¯å®šä¸èƒ½éšæœºåˆ†é…ï¼Œæˆ‘ä»¬éœ€è¦æŠŠé è¿‘ç‚¹çš„æ‹¿æ¥åˆ†é…ï¼Œæˆ‘ä»¬çš„å›¾ä¸­çš„ç‚¹å°±æ˜¯æ¯ä¸€ä¸ªä¸€ä¸ªè¿æ¥èµ·æ¥çš„ï¼Œä¸€ä¸ªæœ€ç®€å•çš„æ€è·¯å°±æ˜¯åƒè¿™æ ·æ¥åˆ†é…ï¼Œé è¿‘çš„åº—æˆ‘ä»¬æ¥åˆ†é…ï¼š</p>

<p><img src="images/sphere_05.png" alt=""></p>

<p>æ‰€ä»¥æ ¹æ®è¿™ä¸ªæ€è·¯ï¼Œå¯ä»¥å†™å‡ºæŒ‰ç…§ç‚¹çš„indexæ¥å†™å‡ºçš„åˆ†é…åƒæ˜¯è¿™æ ·ï¼š</p>

<div><pre><code class="language-none">triangles = []

for i in range(n):
    start = i * n
    for j in range(n - 1):
        a = start + j
        b = a + 1
        c = a + n 
        d = c + 1
        triangles.append(Triangle(a, d, b, color))
        triangles.append(Triangle(a, c, d, color))</code></pre></div>

<p>æœ‰äº†å¦‚ä½•æ¨¡ä»¿çƒä½“çš„ä¼ªç ä¹‹åï¼Œæˆ‘ä»¬æŠŠå®ƒåŠ å…¥ä»£ç ä¸­ï¼Œç„¶åå†æ¥çœ‹ç»“æœï¼š</p>

<p><img src="images/raster13.png" alt=""></p>

<p>ä¸å‡ºæˆ‘ä»¬æ‰€æ–™ï¼Œçƒä½“ä¼šæœ‰ä¸€äº›å¾ˆæ˜æ˜¾çš„é¢ï¼Œè™½ç„¶æœ‰ä¸€ç§å¯çˆ±çš„æ•ˆæœ n(<em>â‰§â–½â‰¦</em>)n ä½†æ˜¯æƒ³ç”»ä¸€ä¸ª&#39;çœŸä¸€ç‚¹çš„çƒä½“&#39;çš„äººæ˜¯ä¸ä¼šæ»¡æ„çš„ã€‚</p>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥è§£å†³å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Œä»¥åŠé™¤äº† flat shading ä¹‹å¤–çš„åˆ«çš„ shading æŠ€æœ¯ã€‚</p>

<h1 id="toc_94">Gouraud ç€è‰²</h1>

<p>ä¹‹å‰æˆ‘ä»¬çœ‹åˆ°çš„çƒä½“å¹¶ä¸æ˜¯å¾ˆâ€˜çƒâ€™ï¼Œ ä¸€ä¸ªæœ€ç®€å•çš„ä¼˜åŒ–åŠæ³•å°±æ˜¯åƒæˆ‘ä»¬ç”»æ¸å˜ä¸‰è§’å½¢ä¸€æ ·ï¼Œè®¡ç®—å‡ºä¸‰è§’å½¢æ¯ä¸€ä¸ªé¡¶ç‚¹çš„äº®åº¦ï¼Œç„¶åçº¿æ€§çš„ç®—å‡ºä¸‰è§’å½¢ä¸­æ¯ä¸€ä¸ªç‚¹çš„äº®åº¦ã€‚æ ¹æ®è¿™ä¸ªæ¥ç”»å›¾ã€‚è¿™ä¸ªåŠæ³•å°±å«åš Gouraud ç€è‰²ï¼ŒæŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œä½œç”¨äºçƒå’ŒçŸ©å½¢ä¸Šã€‚</p>

<p><img src="images/raster14.png" alt=""></p>

<p>è·Ÿä¸Šä¸€ç« çš„ flat ç€è‰²åŸºæœ¬æ²¡å•¥åŒºåˆ«ï¼Œ o(â•¯â–¡â•°)o</p>

<p>çƒçš„çŠ¶å†µå¹¶æ²¡æœ‰å¾—åˆ°å¤šå¤§æ”¹å–„ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¾æ—§æ˜¯ç”¨ä¸‰è§’å½¢æ¥æ¨¡æ‹Ÿçƒä½“ï¼Œè€Œæ¯”å¦‚ç›¸é‚»çš„ä¸‰è§’å½¢ï¼Œå®ƒä»¬çš„æ³•å‘é‡çš„è®¡ç®—å‡ºæ¥ç›¸å·®å¾ˆè¿œï¼š</p>

<p><img src="images/adj_triangle.png" alt=""></p>

<p>è¿™æ˜¯å±äºæˆ‘ä»¬ç”¨ä¸‰è§’å½¢æ¨¡æ‹Ÿç‰©ä½“æœ¬èº«çš„ç¼ºé™·ã€‚ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯é’ˆå¯¹æˆ‘ä»¬æ¯ä¸ªé¡¶ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒâ€˜çœŸå®çš„â€™æ³•å‘é‡ï¼Œè€Œä¸æ˜¯è®¡ç®—å‡ºæ¥çš„ã€‚</p>

<p>å¯¹äºçƒä½“ï¼Œå®ƒçš„æ³•å‘é‡å°±æ˜¯è¿æ¥ä»çƒå¿ƒæŒ‡å‘çƒä¸Šè¿™ä¸€ç‚¹çš„å‘é‡ã€‚è¿™å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œåˆšå¥½æ˜¯å°èœä¸€å ï¼Œå› ä¸ºæˆ‘ä»¬æ¨¡æ‹Ÿçƒçš„æ—¶å€™å°±æ˜¯ç”Ÿæˆäº†ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦ç»™å‡ºå¯¹åº”ç‚¹çš„åæ ‡å°±è¡Œäº†ã€‚</p>

<p>æŒ‰ç…§è¿™æ ·çš„æ€è·¯ï¼Œæˆ‘ä»¬æ¥æ›´æ–°ä¸€ä¸‹ model åŸå‹ï¼š</p>

<div><pre><code class="language-none">model {
    name = cube
    vertexes {
        0 = (-1, -1, -1)
        1 = (-1, -1, 1)
        2 = (-1, 1, 1)
        ...
    }
    triangles {
        0 = {
            vertexes = [0, 1, 2]
            normals = [(-1, 0, 0), (-1, 0, 0), (-1, 0, 0)]
        }
        ... 
    }
}</code></pre></div>

<p>æ‰€ä»¥æˆ‘ä»¬ç”Ÿæˆçƒçš„ä»£ç ç¨ä½œä¿®æ”¹ï¼š</p>

<div><pre><code class="language-none">def generateSphere(n, r, color):
    &quot;&quot;&quot;
    this will generate a sphere sitting in O and divide as mentioned
    &quot;&quot;&quot;
    vertexes = []
    triangles = []

    for d in range(n+1):
        yb = 2 * r * d / n - r
        for i in range(n):
            alpha = 2 * pi * i / n 
            rprime = sqrt(r * r - yb * yb)
            xb = rprime * cos(alpha)
            zb = rprime * sin(alpha)
            vertexes.append(Vector3(xb, yb, zb))

    for i in range(n):
        start = i * n
        for j in range(n - 1):
            a = start + j
            b = a + 1
            c = a + n 
            d = c + 1
            triangles.append(Triangle(a, d, b, color, vertexes[a], vertexes[d], vertexes[b]))
            triangles.append(Triangle(a, c, d, color, vertexes[a], vertexes[c], vertexes[d]))

    return Model(vertexes, triangles, Vector3(0, 0, 0), r)</code></pre></div>

<p>å½“ç„¶å¯¹åº”çš„ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ”¹ cube çš„æ¨¡å‹ï¼Œç»™æ¯ä¸ªç‚¹ä¹Ÿå¡«ä¸Šå¯¹åº”çš„æ³•å‘é‡ã€‚</p>

<p>ç„¶åè®¡ç®—çš„æ—¶å€™æ³¨æ„æˆ‘ä»¬åšå˜æ¢çš„æ—¶å€™æ³•å‘é‡ä¹Ÿè¦è·Ÿç€æ”¹å˜ã€‚</p>

<p><img src="images/raster15.png" alt=""></p>

<p>è¿™æ ·ä¸€çœ‹ï¼Œçƒä½“å¥½çœ‹ä¸€äº›o(â•¯â–¡â•°)o </p>

<h2 id="toc_95">Gourandç€è‰²çš„ç¼ºé™·</h2>

<p>Gouraud ç€è‰² è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“æˆ‘ä»¬æŠŠç‚¹å…‰æºæŒªè¿‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬å½“ç„¶æœŸå¾…ç‰©ä½“ä¼šæ›´äº®ï¼Œå› ä¸ºé è¿‘äº†ï¼Œä½†é—®é¢˜æ˜¯ç‰©ä½“åè€Œå˜æš—äº†ã€‚</p>

<p>åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬è®¡ç®—çš„æ˜¯æ¯ä¸ªé¡¶ç‚¹ä¸Šé¢çš„äº®åº¦ï¼Œç„¶åæ ¹æ®å†æ ¹æ®é¡¶ç‚¹æ¥åšçº¿æ€§æ’å…¥ï¼š</p>

<p><img src="images/point_light_dark.png" alt=""></p>

<p>æ˜¯å› ä¸ºç‚¹çš„æ³•å‘é‡å’Œç‚¹å…‰æºä¹‹é—´çš„è§’åº¦ É‘ ä¼šè¶‹è¿‘äº90Â°ï¼Œç„¶å cos É‘ ä¼šè¶‹è¿‘äº0ï¼Œè¿™æ ·å¯¼è‡´çš„ç»“æœæ˜¯æˆ‘ä»¬åšçº¿æ€§æ’å…¥ä¼šæ•´ä¸ªæŠŠä¸‰è§’å½¢å˜æš—ï¼Œè€Œä¸æ˜¯æŒ‰ç…§ç‚¹çš„çœŸæ­£çš„æ³•å‘é‡å’Œç‚¹å…‰æºä¹‹é—´å¤¹è§’å˜å°ï¼Œå˜å¾—æ›´äº®ã€‚</p>

<h1 id="toc_96">Phong ç€è‰²</h1>

<ul>
<li>å¹³é¢ç€è‰²ï¼š é’ˆå¯¹æ¯ä¸€ä¸ªä¸‰è§’å½¢åªè®¡ç®—ä¸€ä¸ªå…‰ç…§</li>
<li>Gouraud ç€è‰²ï¼š é’ˆå¯¹æ¯ä¸ªä¸‰è§’å½¢è®¡ç®—ä¸‰ä¸ªå…‰ç…§ï¼ŒåŒæ—¶é’ˆå¯¹ä¸‰è§’å½¢ä¸­æ¯ä¸ªç‚¹åšçº¿æ€§æ’å…¥</li>
</ul>

<p>åœ¨è¿™ä¹‹ä¸Šè¿˜èƒ½æƒ³åˆ°çš„ä¼˜åŒ–å°±æ˜¯é’ˆå¯¹æ¯ä¸ªåƒç´ æ¥çœ‹å®ƒçš„å…‰ç…§ï¼Œæ¯•ç«Ÿæˆ‘ä»¬åœ¨å…‰çº¿è¿½è¸ªä¸­å°±æ˜¯è¿™ä¹ˆåšçš„ã€‚</p>

<p>åœ¨è¿™é‡Œçœ‹çœ‹æˆ‘ä»¬çš„è®¡ç®—ï¼Œé’ˆå¯¹ç”»å¸ƒä¸Šçš„ä¸€ä¸ªç‚¹P(x&#39;, y&#39;)ï¼Œæˆ‘ä»¬çŸ¥é“:</p>

<p>\[
x&#39; = \frac{Xd}{Z}
\]</p>

<p>\[
y&#39; = \frac{Yd}{Z}
\]</p>

<p>åŒæ—¶æˆ‘ä»¬åœ¨åšéšè—é¢æ¶ˆé™¤çš„æ—¶å€™æœ‰ 1/z è¿™ä¸ªå€¼ï¼š</p>

<p>\[
x&#39; = Xd\frac{1}{Z}
\]</p>

<p>\[
y&#39; = Yd\frac{1}{Z}
\]</p>

<p>æˆ‘ä»¬æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»ç”»å¸ƒä¸Šçš„æŠ•å½±çš„ç‚¹å¾—åˆ°ç©ºé—´3dä¸­çš„ç‚¹ï¼š</p>

<p>\[
X = x&#39; / d_{\frac{1}{Z}}
\]</p>

<p>\[
Y = y&#39; / d_{\frac{1}{Z}}
\]</p>

<p>\[
Z = 1 / d_{\frac{1}{Z}}
\]</p>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œéœ€è¦çŸ¥é“:</p>

<ul>
<li> \(\overrightarrow{V}\) : è¿™ä¸ªå¾ˆå®¹æ˜“è®¡ç®—å› ä¸ºæ‘„åƒå¤´çš„ä½ç½®å·²çŸ¥</li>
<li> \(\overrightarrow{N}\) : è™½ç„¶æˆ‘ä»¬åªæœ‰é¡¶ç‚¹å¤„çš„æ³•å‘é‡ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰çº¿æ€§æ’å…¥ï¼Œo(â•¯â–¡â•°)oï¼Œæˆ‘ä»¬å¯ä»¥ç”¨çº¿æ€§æ’å…¥çš„åŠæ³•æ¥å¤„ç†æ³•å‘é‡ï¼Œo(â•¯â–¡â•°)o</li>
</ul>

<p>æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œç€è‰²ç»“æœï¼š</p>

<p><img src="images/raster16.png" alt=""></p>

<p>åŒæ—¶å‘ç°åœ¨ Gouraud ç€è‰²ä¸­é‡åˆ°çš„è¶Šé è¿‘ç‚¹å…‰æºè¶Šæš—çš„é—®é¢˜ä¹Ÿè¢«è§£å†³äº†ã€‚å› ä¸ºæˆ‘ä»¬è¿™é‡Œçš„æ³•å‘é‡æ˜¯çº¿æ€§æ’å…¥å¾—åˆ°çš„ã€‚cool.</p>

<h1 id="toc_97">çº¹ç†</h1>

<p>æˆ‘ä»¬ä¸ä»…ä»…æƒ³ç”»çƒä½“å’Œæ­£æ–¹ä½“ï¼Œæˆ‘ä»¬ä¹Ÿåƒè®©ç‰©ä½“â€˜é€¼çœŸâ€™èµ·æ¥ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³ç”»ä¸€ä¸ªæœ¨å¤´çš„é›†è£…ç®±ã€‚æœ‰ä¸¤ä¸ªæ€è·¯ï¼š</p>

<ul>
<li>ç”»å¾ˆå¤šä¸‰è§’å½¢ç„¶åæ¥é‡ç°æœ¨å¤´çš„çº¹ç†</li>
<li>ç»™æˆ‘ä»¬å·²ç»ç”»å¥½çš„ç«‹æ–¹ä½“ä¸Šè´´ä¸Šæœ¨è´¨çš„æ•ˆæœ</li>
</ul>

<p>æˆ‘ä»¬é‡‡å–ç¬¬äºŒç§æ–¹å¼å› ä¸ºæˆ‘ä»¬å·²ç»æœ‰äº†ç”»å¥½çš„ç«‹æ–¹ä½“äº†ï¼Œâ•®(â•¯_â•°)â•­ä½•å†µç¬¬ä¸€ç§ä¼šå¢åŠ æ›´å¤šçš„å‡ ä½•ï¼Œæ›´å¤æ‚æ„å‘³ç€æ›´æ…¢ã€‚</p>

<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€å¼ å›¾æ¥è¦†ç›–åœ¨ç«‹æ–¹ä½“ä¸Š </p>

<p><img src="images/crate-texture.jpg" alt=""></p>

<p>ç„¶åæˆ‘ä»¬éœ€è¦å†³å®šè¿™å¼ å›¾å¦‚ä½•æ”¾åœ¨å›¾ç‰‡ä¸Šï¼Œä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯é’ˆå¯¹æ¯ä¸ªä¸‰è§’å½¢æ¥çœ‹</p>

<p><img src="images/r17-texture-mapping.png" alt=""></p>

<p>æ³¨æ„åªç”¨å›¾çš„ä¸€éƒ¨åˆ†ä¹Ÿæ˜¯å®Œå…¨okçš„ã€‚</p>

<p>æˆ‘ä»¬å®šä¹‰ u å’Œ v</p>

<p>\[
 0 \le u \le 1
 \]</p>

<p>\[
 0 \le v \le 1
 \]</p>

<p>(u, v)  ä¼šå¯¹åº”åˆ°å›¾ç‰‡(å®½w, é«˜h)ä¸Šçš„ (u(w - 1), v(h - 1))ï¼Œè¿™æ ·å®šä¹‰çš„çš„å¥½å¤„å½“ç„¶å¾ˆå¤šå•¦ï¼Œ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥éšæ„æ¢çº¹ç†å›¾ï¼Œè¿˜å¯ä»¥éšæ„æ¢çº¹ç†å›¾å¤§å°...ç­‰ç­‰ç­‰ã€‚</p>

<p><img src="images/uvwh.png" alt=""></p>

<p>é’ˆå¯¹æ¯ä¸ªä¸‰è§’å½¢çš„é¡¶ç‚¹æˆ‘ä»¬æœ‰ (u, v)ï¼Œ åŒæ ·ç”¨çº¿æ€§æ’å€¼ç®—å‡ºå¯¹äºä¸‰è§’å½¢çš„æ¯ä¸€ç‚¹çš„ (u, v)ï¼Œç„¶åæ ¹æ®è¿™ä¸ª (u, v) æ¥ç”»å›¾ã€‚</p>

<p><img src="images/texture_uv.png" alt=""></p>

<p>çœ‹ç»“æœï¼š</p>

<p><img src="images/raster17.png" alt=""></p>

<p>ä¸é”™ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä»”ç»†ä¸€ç‚¹çœ‹æ­£æ–¹ä½“çš„ä¸­é—´éƒ¨åˆ†ï¼Œå‘ç°å®ƒæ˜¯å¼¯æŠ˜çš„ï¼Œo(â•¯â–¡â•°)oï¼Œé—®é¢˜è¿˜æ˜¯åœ¨äºæˆ‘ä»¬å‡è®¾ u å’Œ v åœ¨å±å¹•ä¸­æ˜¯çº¿æ€§å˜åŒ–çš„ã€‚è¿™å°±è·Ÿæˆ‘ä»¬ Depth buffer ä¸€æ ·çš„é“ç†ï¼Œæˆ‘ä»¬éœ€è¦ç”¨çš„æ˜¯</p>

<p>\[
u = \frac{\frac{u}{z}}{\frac{1}{z}}
\]</p>

<p>\[
v = \frac{\frac{v}{z}}{\frac{1}{z}}
\]</p>

<p>ä¿®æ­£ä¹‹åçš„æ•ˆæœï¼š</p>

<p><img src="images/raster18.png" alt=""></p>



<script type="text/x-mathjax-config">
(function () {

MathJax.Hub.Config({
	'showProcessingMessages': false,
	'messageStyle': 'none'
});

if (typeof MathJaxListener !== 'undefined') {
	MathJax.Hub.Register.StartupHook('End', function () {
		MathJaxListener.invokeCallbackForKey_('End');
	});
}

})();
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


</body>

</html>
